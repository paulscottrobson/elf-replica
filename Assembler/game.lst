 AS V1.42 Beta [Bld 102] - source file game.asm - page 1 - 7/3/2016 13:36:27


       1/       0 :                     ; ************************************************************************************************************
       2/       0 :                     ; ************************************************************************************************************
       3/       0 :                     ;
       4/       0 :                     ;									Revenge of the Killer Princesses
       5/       0 :                     ;									================================
       6/       0 :                     ;
       7/       0 :                     ;								  Written by Paul Robson June/July 2016
       8/       0 :                     ;	
       9/       0 :                     ;	  Written for the Netronics ELF but should port to other 1802/1861 devices with sufficient RAM memory.
      10/       0 :                     ;	  Main porting issue is the keyboard routine.
      11/       0 :                     ;
      12/       0 :                     ; ************************************************************************************************************
      13/       0 :                     ; ************************************************************************************************************
      14/       0 :                     
      15/       0 :                     	include 1802.inc
(1)    1/       0 :                     ; ************************************************************************************************************
(1)    2/       0 :                     ; ************************************************************************************************************
(1)    3/       0 :                     ;
(1)    4/       0 :                     ;												1802 Generic Routines
(1)    5/       0 :                     ;
(1)    6/       0 :                     ; ************************************************************************************************************
(1)    7/       0 :                     ; ************************************************************************************************************
(1)    8/       0 :                     
(1)    9/       0 :                     	cpu 	1802
(1)   10/       0 :                     
(1)   11/       0 : =0H                 r0 = 0 																			; register names
(1)   12/       0 : =1H                 r1 = 1
(1)   13/       0 : =2H                 r2 = 2
(1)   14/       0 : =3H                 r3 = 3
(1)   15/       0 : =4H                 r4 = 4
(1)   16/       0 : =5H                 r5 = 5
(1)   17/       0 : =6H                 r6 = 6
(1)   18/       0 : =7H                 r7 = 7
(1)   19/       0 : =8H                 r8 = 8
(1)   20/       0 : =9H                 r9 = 9 						
(1)   21/       0 : =AH                 ra = 10
(1)   22/       0 : =BH                 rb = 11 																		; stops us using RB accidentally
(1)   23/       0 : =CH                 rc = 12
(1)   24/       0 : =DH                 rd = 13
(1)   25/       0 : =EH                 re = 14
(1)   26/       0 : =FH                 rf = 15
(1)   27/       0 :                     
(1)   28/       0 :                     lri Macro 	reg,address 														; load constant into 16 bit reg
(1)   29/       0 :                     	ldi 	(address)/256
(1)   30/       0 :                     	phi 	reg
(1)   31/       0 :                     	ldi 	(address)&255
(1)   32/       0 :                     	plo 	reg
(1)   33/       0 :                     	endm
(1)   34/       0 :                     
(1)   35/       0 :                     call Macro 	reg,address 														; call routine via mark.
(1)   36/       0 :                     	lri 	reg,address
(1)   37/       0 :                     	recall 	reg
(1)   38/       0 :                     	endm
(1)   39/       0 :                     
(1)   40/       0 :                     recall Macro reg 																; recall (re-entrant macro)
(1)   41/       0 :                     	mark
(1)   42/       0 :                     	sep 	reg
(1)   43/       0 :                     	dec 	r2
(1)   44/       0 :                     	endm
(1)   45/       0 :                     
 AS V1.42 Beta [Bld 102] - source file game.asm(1802.inc) - page 2 - 7/3/2016 13:36:27


(1)   46/       0 :                     return Macro 																	; return from routine
(1)   47/       0 :                     	sex 	r2
(1)   48/       0 :                     	inc 	r2
(1)   49/       0 :                     	ret
(1)   50/       0 :                     	endm
(1)   51/       0 :                     
(1)   52/       0 :                     
      16/       0 :                     
      17/       0 : =F00H               screen =  	0F00h																; this is the display screen.
      18/       0 : =E00H               buffer = 	0E00h																; this page has the buffer in it
      19/       0 : =D00H               map = 		0D00h 																; this page has the map in it.
      20/       0 : =CE8H               stack = 	0CE8h 																; stack top
      21/       0 :                     
      22/       0 : =CFCH               timers = 	0CFCh 																; 4 timers must end at page top.
      23/       0 : =CFBH               speed = 	0CFBh 																; princess speed.
      24/       0 :                     
      25/       0 : =CF4H               ppvector =  0CF4h																; player position vector.
      26/       0 : =CF3H               player = 	0CF3h 																; player offset in map
      27/       0 : =CF2H               direction = 0CF2h 																; 0 = right,1 = down, 2 = left, 3 = up
      28/       0 : =CF1H               kills10 =   0CF1h 																; dead princesses.
      29/       0 : =CF0H               kills01 = 	0CF0h
      30/       0 :                     
      31/       0 : =CFCH               moveTimer = timers 																; first timer controls move/turn.
      32/       0 : =CFDH               fireTimer = timers+1 															; second timer controls firing
      33/       0 : =CFEH               prinTimer = timers+2 															; third timer controls movement
      34/       0 :                     
      35/       0 : =80H                MAZE_Wall = 080h 																; bit 7 indicates wall
      36/       0 : =0H                 MAZE_Open = 000h 																; $00 is open space
      37/       0 : =1H                 MAZE_Princess = 001h 															; $01-$7F is princess.
      38/       0 :                     
      39/       0 : 70                  	ret 																		; 1802 interrupts on. 
      40/       1 : C4                  	nop
      41/       2 : (MACRO)             	lri 	r1,Interrupt 														; set interrupt vector
      41/       2 : F8 03                       ldi     (INTERRUPT)/256
      41/       4 : B1                          phi     R1
      41/       5 : F8 CB                       ldi     (INTERRUPT)&255
      41/       7 : A1                          plo     R1
      42/       8 : (MACRO)             	lri 	r2,Stack 															; set stack address
      42/       8 : F8 0C                       ldi     (STACK)/256
      42/       A : B2                          phi     R2
      42/       B : F8 E8                       ldi     (STACK)&255
      42/       D : A2                          plo     R2
      43/       E : (MACRO)             	lri 	r3,Main 															; main program address
      43/       E : F8 00                       ldi     (MAIN)/256
      43/      10 : B3                          phi     R3
      43/      11 : F8 15                       ldi     (MAIN)&255
      43/      13 : A3                          plo     R3
      44/      14 : D3                  	sep 	r3 																	; go to main routine
      45/      15 :                     Main:
      46/      15 : E2                  	sex 	r2 																	; turn video on
      47/      16 : 69                  	inp		1
      48/      17 :                     
      49/      17 :                     ; ************************************************************************************************************
      50/      17 :                     ; ************************************************************************************************************
      51/      17 :                     ;
      52/      17 :                     ;											Initialisation code
      53/      17 :                     ;
      54/      17 :                     ; ************************************************************************************************************
      55/      17 :                     ; ************************************************************************************************************
      56/      17 :                     
 AS V1.42 Beta [Bld 102] - source file game.asm - page 3 - 7/3/2016 13:36:27


      57/      17 : (MACRO)             	call 	r4,CreateMaze 														; create the maze
      57/      17 :  (MACRO-2)                  lri     R4,CREATEMAZE
      57/      17 : F8 01                       ldi     (CREATEMAZE)/256
      57/      19 : B4                          phi     R4
      57/      1A : F8 00                       ldi     (CREATEMAZE)&255
      57/      1C : A4                          plo     R4
      57/      1D :  (MACRO-2)                  recall  R4
      57/      1D : 79                          mark
      57/      1E : D4                          sep     R4
      57/      1F : 22                          dec     r2
      58/      20 : (MACRO)             	call 	r4,ResetPlayer 														; reset the player
      58/      20 :  (MACRO-2)                  lri     R4,RESETPLAYER
      58/      20 : F8 02                       ldi     (RESETPLAYER)/256
      58/      22 : B4                          phi     R4
      58/      23 : F8 3E                       ldi     (RESETPLAYER)&255
      58/      25 : A4                          plo     R4
      58/      26 :  (MACRO-2)                  recall  R4
      58/      26 : 79                          mark
      58/      27 : D4                          sep     R4
      58/      28 : 22                          dec     r2
      59/      29 :                     
      60/      29 : (MACRO)             	lri 	r4, map+075h 														; dummy princess
      60/      29 : F8 0D                       ldi     (MAP+075H)/256
      60/      2B : B4                          phi     R4
      60/      2C : F8 75                       ldi     (MAP+075H)&255
      60/      2E : A4                          plo     R4
      61/      2F : F8 19               	ldi 	1+0*2+3*8
      62/      31 : 54                  	str 	r4
      63/      32 :                     
      64/      32 : (MACRO)             	lri 	r4,speed  															; dummy speed
      64/      32 : F8 0C                       ldi     (SPEED)/256
      64/      34 : B4                          phi     R4
      64/      35 : F8 FB                       ldi     (SPEED)&255
      64/      37 : A4                          plo     R4
      65/      38 : F8 3C               	ldi 	60
      66/      3A : 54                  	str 	r4
      67/      3B :                     
      68/      3B :                     Loop:
      69/      3B : (MACRO)             	call 	r4,MovePrincesses 													; move all the princesses
      69/      3B :  (MACRO-2)                  lri     R4,MOVEPRINCESSES
      69/      3B : F8 06                       ldi     (MOVEPRINCESSES)/256
      69/      3D : B4                          phi     R4
      69/      3E : F8 00                       ldi     (MOVEPRINCESSES)&255
      69/      40 : A4                          plo     R4
      69/      41 :  (MACRO-2)                  recall  R4
      69/      41 : 79                          mark
      69/      42 : D4                          sep     R4
      69/      43 : 22                          dec     r2
      70/      44 : (MACRO)             	call	r4,MovePlayer 														; move player
      70/      44 :  (MACRO-2)                  lri     R4,MOVEPLAYER
      70/      44 : F8 04                       ldi     (MOVEPLAYER)/256
      70/      46 : B4                          phi     R4
      70/      47 : F8 00                       ldi     (MOVEPLAYER)&255
      70/      49 : A4                          plo     R4
      70/      4A :  (MACRO-2)                  recall  R4
      70/      4A : 79                          mark
      70/      4B : D4                          sep     R4
      70/      4C : 22                          dec     r2
      71/      4D : (MACRO)             	call 	r4,Repaint 															; repaint display
      71/      4D :  (MACRO-2)                  lri     R4,REPAINT
 AS V1.42 Beta [Bld 102] - source file game.asm - page 4 - 7/3/2016 13:36:27


      71/      4D : F8 03                       ldi     (REPAINT)/256
      71/      4F : B4                          phi     R4
      71/      50 : F8 00                       ldi     (REPAINT)&255
      71/      52 : A4                          plo     R4
      71/      53 :  (MACRO-2)                  recall  R4
      71/      53 : 79                          mark
      71/      54 : D4                          sep     R4
      71/      55 : 22                          dec     r2
      72/      56 : (MACRO)             	call 	r4,DeathCheck														; check if died
      72/      56 :  (MACRO-2)                  lri     R4,DEATHCHECK
      72/      56 : F8 04                       ldi     (DEATHCHECK)/256
      72/      58 : B4                          phi     R4
      72/      59 : F8 A5                       ldi     (DEATHCHECK)&255
      72/      5B : A4                          plo     R4
      72/      5C :  (MACRO-2)                  recall  R4
      72/      5C : 79                          mark
      72/      5D : D4                          sep     R4
      72/      5E : 22                          dec     r2
      73/      5F : 30 3B               	br 		Loop
      74/      61 :                     
      75/     100 :                     	org 	100h
      76/     100 :                     
      77/     100 :                     code:
      78/     100 :                     ;
      79/     100 :                     ;	Block 0
      80/     100 :                     ;
      81/     100 :                     	include maze.asm 															; maze creator & RNG ($7B)
(1)    1/     100 :                     ; ************************************************************************************************************
(1)    2/     100 :                     ; ************************************************************************************************************
(1)    3/     100 :                     ;
(1)    4/     100 :                     ;												Maze Creator
(1)    5/     100 :                     ;
(1)    6/     100 :                     ;	Uses RB,RC,RD,RF.
(1)    7/     100 :                     ; ************************************************************************************************************
(1)    8/     100 :                     ; ************************************************************************************************************
(1)    9/     100 :                     
(1)   10/     100 :                     CreateMaze:
(1)   11/     100 : E2                  	sex 	r2
(1)   12/     101 : (MACRO)             	lri 	rc,map 																; point RC to the map.
(1)   12/     101 : F8 0D                       ldi     (MAP)/256
(1)   12/     103 : BC                          phi     RC
(1)   12/     104 : F8 00                       ldi     (MAP)&255
(1)   12/     106 : AC                          plo     RC
(1)   13/     107 :                     __CMFill:
(1)   14/     107 : F8 80               	ldi 	MAZE_Wall 													 		; fill the map with solid walls.
(1)   15/     109 : 5C                  	str 	rc
(1)   16/     10A : 1C                  	inc 	rc
(1)   17/     10B : 8C                  	glo 	rc
(1)   18/     10C : 3A 07               	bnz 	__CMFill
(1)   19/     10E : (MACRO)             	lri 	rc,map+16+1 														; row 1 column 1
(1)   19/     10E : F8 0D                       ldi     (MAP+16+1)/256
(1)   19/     110 : BC                          phi     RC
(1)   19/     111 : F8 11                       ldi     (MAP+16+1)&255
(1)   19/     113 : AC                          plo     RC
(1)   20/     114 : (MACRO)             	lri 	rb,RandomNumber 													; r5 = random subroutine (runs in R4)
(1)   20/     114 : F8 01                       ldi     (RANDOMNUMBER)/256
(1)   20/     116 : BB                          phi     RB
(1)   20/     117 : F8 54                       ldi     (RANDOMNUMBER)&255
(1)   20/     119 : AB                          plo     RB
(1)   21/     11A :                     __CMGenerate:
 AS V1.42 Beta [Bld 102] - source file game.asm(maze.asm) - page 5 - 7/3/2016 13:36:27


(1)   22/     11A : 8C                  	glo 	rc 																	; do not overright right hand wall
(1)   23/     11B : FA 0F               	ani 	0Fh 
(1)   24/     11D : FB 0F               	xri 	0Fh
(1)   25/     11F : 32 4B               	bz 		__CMNext
(1)   26/     121 :                     
(1)   27/     121 : 8C                  	glo 	rc  																; makes the checkerboard pattern.
(1)   28/     122 : FA 11               	ani	 	011h
(1)   29/     124 : FB 11               	xri 	011h 																
(1)   30/     126 : 3A 4B               	bnz 	__CMNext
(1)   31/     128 : F8 00               	ldi 	MAZE_Open
(1)   32/     12A : 5C                  	str 	rc 																	; write 00 (maze open) here.
(1)   33/     12B :                     
(1)   34/     12B : (MACRO)             	recall 	rb																	; random number
(1)   34/     12B : 79                          mark
(1)   34/     12C : DB                          sep     RB
(1)   34/     12D : 22                          dec     r2
(1)   35/     12E : FA 0F               	ani 	15
(1)   36/     130 : FF 0B               	smi 	11 																	; check mod 16 < 11
(1)   37/     132 : 33 39               	bdf 	__CMNotRight
(1)   38/     134 : 1C                  	inc 	rc 																	; if so open square to right.
(1)   39/     135 : F8 00               	ldi 	MAZE_Open
(1)   40/     137 : 5C                  	str 	rc
(1)   41/     138 : 2C                  	dec 	rc
(1)   42/     139 :                     __CMNotRight:
(1)   43/     139 :                     
(1)   44/     139 : (MACRO)             	recall 	rb 																	; random number
(1)   44/     139 : 79                          mark
(1)   44/     13A : DB                          sep     RB
(1)   44/     13B : 22                          dec     r2
(1)   45/     13C : FA 0F               	ani 	15
(1)   46/     13E : FF 0B               	smi 	11 			 														; check mod 16 < 11
(1)   47/     140 : 33 4B               	bdf 	__CMNotDown
(1)   48/     142 : 9C                  	ghi 	rc 																	; open square down - point RD to it
(1)   49/     143 : BD                  	phi 	rd
(1)   50/     144 : 8C                  	glo 	rc
(1)   51/     145 : FC 10               	adi 	16
(1)   52/     147 : AD                  	plo 	rd
(1)   53/     148 : F8 00               	ldi 	MAZE_Open 															; open that square
(1)   54/     14A : 5D                  	str 	rd
(1)   55/     14B :                     __CMNotDown:
(1)   56/     14B :                     
(1)   57/     14B :                     __CMNext:
(1)   58/     14B : 1C                  	inc 	rc 																	; next
(1)   59/     14C : 8C                  	glo 	rc
(1)   60/     14D : FB DF               	xri 	0DFh 																; reached bottom right ?
(1)   61/     14F : 3A 1A               	bnz 	__CMGenerate
(1)   62/     151 : (MACRO)             	return
(1)   62/     151 : E2                          sex     r2
(1)   62/     152 : 12                          inc     r2
(1)   62/     153 : 70                          ret
(1)   63/     154 :                     
(1)   64/     154 :                     ; ************************************************************************************************************
(1)   65/     154 :                     ; ************************************************************************************************************
(1)   66/     154 :                     ;
(1)   67/     154 :                     ;							Random Number Generator - same as class LFSR in gen.py
(1)   68/     154 :                     ;
(1)   69/     154 :                     ;	uses RF. 
(1)   70/     154 :                     ; ************************************************************************************************************
(1)   71/     154 :                     ; ************************************************************************************************************
(1)   72/     154 :                     
 AS V1.42 Beta [Bld 102] - source file game.asm(maze.asm) - page 6 - 7/3/2016 13:36:27


(1)   73/     154 :                     RandomNumber:
(1)   74/     154 : (MACRO)             	lri 	rf,__RNHighM1+1
(1)   74/     154 : F8 01                       ldi     (__RNHIGHM1+1)/256
(1)   74/     156 : BF                          phi     RF
(1)   74/     157 : F8 5B                       ldi     (__RNHIGHM1+1)&255
(1)   74/     159 : AF                          plo     RF
(1)   75/     15A :                     __RNHighM1:
(1)   76/     15A : F8 AC               	ldi 	0ACh																; get seeded value
(1)   77/     15C : F6                  	shr 																		; shift it right
(1)   78/     15D : 5F                  	str 	rf 																	; write it back
(1)   79/     15E : F8 62               	ldi 	(__RNLowM1+1) & 0FFh 												; change pointer
(1)   80/     160 : AF                  	plo 	rf
(1)   81/     161 :                     __RNLowM1:
(1)   82/     161 : F8 E1               	ldi 	0E1h 																; get upper seeded value
(1)   83/     163 : 76                  	shrc  																		; rotate it right and in
(1)   84/     164 : 5F                  	str 	rf 																	; write it back.
(1)   85/     165 : E2                  	sex 	r2																	; save at TOS
(1)   86/     166 : 52                  	str 	r2
(1)   87/     167 : 3B 70               	bnf  	__RNNoToggle 														; if bit shifted out set
(1)   88/     169 :                     
(1)   89/     169 : F8 5B               	ldi 	(__RNHighM1+1) & 0FFh												; exor the high bit with $B4
(1)   90/     16B : AF                  	plo 	rf
(1)   91/     16C : 0F                  	ldn 	rf
(1)   92/     16D : FB B4               	xri 	0B4h
(1)   93/     16F : 5F                  	str 	rf
(1)   94/     170 :                     __RNNoToggle:
(1)   95/     170 : 02                  	ldn 	r2 																	; read TOS.
(1)   96/     171 : FE                  	shl 																		; put bit 7 into DF
(1)   97/     172 : F8 00               	ldi 	0 																	; add 0 + (R2) + DF 
(1)   98/     174 : 74                  	adc 	
(1)   99/     175 : (MACRO)             	return 	
(1)   99/     175 : E2                          sex     r2
(1)   99/     176 : 12                          inc     r2
(1)   99/     177 : 70                          ret
(1)  100/     178 : 30 54               	br 		RandomNumber 														; is re-entrant.
(1)  101/     17A :                     
      82/     17A :                     	include drawing.asm 														; repaint outline/mirror ($64)
(1)    1/     17A :                     ; ************************************************************************************************************
(1)    2/     17A :                     ; ************************************************************************************************************
(1)    3/     17A :                     ;
(1)    4/     17A :                     ;						 	Draw the Outline Frame (with no doors) - top half only.
(1)    5/     17A :                     ;
(1)    6/     17A :                     ;	Uses RC,RD,RE,RF
(1)    7/     17A :                     ; ************************************************************************************************************
(1)    8/     17A :                     ; ************************************************************************************************************
(1)    9/     17A :                     
(1)   10/     17A :                     RepaintDisplayOutline:
(1)   11/     17A : F8 0E               	ldi 	Buffer/256 															; rc points to display position.
(1)   12/     17C : BC                  	phi 	rc 																	; so does rd as we're going to clear it
(1)   13/     17D : BD                  	phi 	rd 																	; the top half of the screen
(1)   14/     17E : F8 00               	ldi 	0
(1)   15/     180 : AC                  	plo 	rc
(1)   16/     181 : AD                  	plo 	rd
(1)   17/     182 :                     _RDClear:
(1)   18/     182 : 8C                  	glo 	rc 																	; rc.0 is zero
(1)   19/     183 : 5D                  	str 	rd 																	; fill display RAM with it.
(1)   20/     184 : 1D                  	inc 	rd
(1)   21/     185 : 8D                  	glo 	rd
(1)   22/     186 : FE                  	shl 																		; only do it half way as we copy
(1)   23/     187 : 3B 82               	bnf 	_RDClear 															; the bottom half.
 AS V1.42 Beta [Bld 102] - source file game.asm(drawing.asm) - page 7 - 7/3/2016 13:36:27


(1)   24/     189 :                     
(1)   25/     189 :                     ; ************************************************************************************************************
(1)   26/     189 :                     ;									    Come back here to reset the masks
(1)   27/     189 :                     ; ************************************************************************************************************
(1)   28/     189 :                     
(1)   29/     189 :                     _RDResetMasks:
(1)   30/     189 : F8 C0               	ldi 	0C0h 																; rf.0 is 11000000 (left write)
(1)   31/     18B : AF                  	plo 	rf
(1)   32/     18C : F8 03               	ldi 	3 																	; rf.1 is 00000011 (right write)
(1)   33/     18E : BF                  	phi 	rf
(1)   34/     18F :                     
(1)   35/     18F :                     ; ************************************************************************************************************
(1)   36/     18F :                     ;				Main repaint loop. rc points to the line position. rf.0 left mask rf.1 right mask
(1)   37/     18F :                     ; ************************************************************************************************************
(1)   38/     18F :                     
(1)   39/     18F :                     _RDLoop:
(1)   40/     18F : 9C                  	ghi		rc 																	; copy rc.1 to rd.1 and re.1
(1)   41/     190 : BD                  	phi 	rd 																	
(1)   42/     191 : BE                  	phi 	re
(1)   43/     192 : 8C                  	glo 	rc 																	; are there no solid blocks yet ?
(1)   44/     193 : FA 07               	ani 	7
(1)   45/     195 : 32 A8               	bz 		_RDNoSolid
(1)   46/     197 :                     
(1)   47/     197 :                     ; ************************************************************************************************************
(1)   48/     197 :                     ;					This draws solid blocks - fill in a whole byte at a time, on left and right
(1)   49/     197 :                     ; ************************************************************************************************************
(1)   50/     197 :                     
(1)   51/     197 : 8C                  	glo 	rc 																	; rd.0 will point to left bit
(1)   52/     198 : AD                  	plo 	rd
(1)   53/     199 : FB 07               	xri 	7																	; rd.1 will point to right bit
(1)   54/     19B : AE                  	plo 	re																	
(1)   55/     19C : 2D                  	dec 	rd
(1)   56/     19D :                     
(1)   57/     19D :                     _RDDrawByteBlocks:
(1)   58/     19D : F8 FF               	ldi 	0FFh 																; write solid block on left.
(1)   59/     19F : 5D                  	str 	rd
(1)   60/     1A0 : 5E                  	str 	re
(1)   61/     1A1 : 2D                  	dec 	rd 																	; move left left and right right
(1)   62/     1A2 : 1E                  	inc 	re
(1)   63/     1A3 : 8E                  	glo 	re 																	; if right hasn't wrapped around
(1)   64/     1A4 : FA 07               	ani 	7
(1)   65/     1A6 : 3A 9D               	bnz 	_RDDrawByteBlocks
(1)   66/     1A8 :                     _RDNoSolid:
(1)   67/     1A8 :                     
(1)   68/     1A8 :                     ; ************************************************************************************************************
(1)   69/     1A8 :                     ;						This writes out the current masks and goes to the next line.
(1)   70/     1A8 :                     ; ************************************************************************************************************
(1)   71/     1A8 :                     
(1)   72/     1A8 : 8C                  	glo 	rc 																	; set rd and re to point to write
(1)   73/     1A9 : AD                  	plo 	rd
(1)   74/     1AA : FB 07               	xri 	7
(1)   75/     1AC : AE                  	plo 	re
(1)   76/     1AD :                     
(1)   77/     1AD : 8C                  	glo 	rc 																	; point rc to the next line.
(1)   78/     1AE : FC 08               	adi 	8
(1)   79/     1B0 : AC                  	plo 	rc
(1)   80/     1B1 :                     
(1)   81/     1B1 : 8F                  	glo 	rf																	; write left mask
(1)   82/     1B2 : 5D                  	str 	rd
(1)   83/     1B3 : F6                  	shr 																		; update the left mask.
 AS V1.42 Beta [Bld 102] - source file game.asm(drawing.asm) - page 8 - 7/3/2016 13:36:27


(1)   84/     1B4 : F6                  	shr	
(1)   85/     1B5 : F9 C0               	ori 	0C0h
(1)   86/     1B7 : AF                  	plo 	rf
(1)   87/     1B8 :                     
(1)   88/     1B8 : 9F                  	ghi 	rf 																	; write right mask
(1)   89/     1B9 : 5E                  	str 	re
(1)   90/     1BA : FE                  	shl 																		; update the right mask.
(1)   91/     1BB : FE                  	shl 
(1)   92/     1BC : F9 03               	ori 	3
(1)   93/     1BE : BF                  	phi	 	rf
(1)   94/     1BF :                     
(1)   95/     1BF : 3B 8F               	bnf 	_RDLoop
(1)   96/     1C1 : 1C                  	inc 	rc 																	; step out 1.
(1)   97/     1C2 : 8C                  	glo 	rc 																	; if not half way down loop back.
(1)   98/     1C3 : 7E                  	shlc
(1)   99/     1C4 : 3B 89               	bnf 	_RDResetMasks
(1)  100/     1C6 : (MACRO)             	return
(1)  100/     1C6 : E2                          sex     r2
(1)  100/     1C7 : 12                          inc     r2
(1)  100/     1C8 : 70                          ret
(1)  101/     1C9 :                     
(1)  102/     1C9 :                     ; ************************************************************************************************************
(1)  103/     1C9 :                     ; ************************************************************************************************************
(1)  104/     1C9 :                     ;
(1)  105/     1C9 :                     ;									Copy top half to bottom half upside down
(1)  106/     1C9 :                     ;
(1)  107/     1C9 :                     ;	Uses RE,RF
(1)  108/     1C9 :                     ; ************************************************************************************************************
(1)  109/     1C9 :                     ; ************************************************************************************************************
(1)  110/     1C9 :                     
(1)  111/     1C9 :                     MirrorDisplay:	
(1)  112/     1C9 : (MACRO)             	lri 	re,Buffer 															; re points to screen top
(1)  112/     1C9 : F8 0E                       ldi     (BUFFER)/256
(1)  112/     1CB : BE                          phi     RE
(1)  112/     1CC : F8 00                       ldi     (BUFFER)&255
(1)  112/     1CE : AE                          plo     RE
(1)  113/     1CF :                     _MDLoop:
(1)  114/     1CF : 8E                  	glo 	re 																	; set up bottom pointer rf
(1)  115/     1D0 : FB F8               	xri 	0F8h
(1)  116/     1D2 : AF                  	plo 	rf	
(1)  117/     1D3 : 9E                  	ghi	 	re
(1)  118/     1D4 : BF                  	phi 	rf
(1)  119/     1D5 : 4E                  	lda 	re 																	; copy data bumping rc
(1)  120/     1D6 : 5F                  	str 	rf
(1)  121/     1D7 : 1F                  	inc 	rf
(1)  122/     1D8 : 8E                  	glo 	re
(1)  123/     1D9 : FE                  	shl 	
(1)  124/     1DA : 3B CF               	bnf 	_MDLoop
(1)  125/     1DC : (MACRO)             	return
(1)  125/     1DC : E2                          sex     r2
(1)  125/     1DD : 12                          inc     r2
(1)  125/     1DE : 70                          ret
(1)  126/     1DF :                     
(1)  127/     1DF :                     
(1)  128/     1DF :                     		
      83/     1DF :                     ;
      84/     1DF :                     ;	Block 1
      85/     1DF :                     ;
      86/     200 :                     	org 	code+100h
      87/     200 :                     	include door.asm 															; door "opening" code. ($3C)
 AS V1.42 Beta [Bld 102] - source file game.asm(door.asm) - page 9 - 7/3/2016 13:36:27


(1)    1/     200 :                     ; ************************************************************************************************************
(1)    2/     200 :                     ; ************************************************************************************************************
(1)    3/     200 :                     ;
(1)    4/     200 :                     ;												Door opening
(1)    5/     200 :                     ;
(1)    6/     200 :                     ;	Uses RE,RF
(1)    7/     200 :                     ; ************************************************************************************************************
(1)    8/     200 :                     ; ************************************************************************************************************
(1)    9/     200 :                     
(1)   10/     200 :                     DoorOpen:
(1)   11/     200 : AE                  	plo 	re 																	; save door position.
(1)   12/     201 : AF                  	plo 	rf 																	; ready to mask it at rf
(1)   13/     202 : FA 04               	ani 	4 																	; 0 for left, 4 for right.
(1)   14/     204 : 32 08               	bz 		__DOLeftMask
(1)   15/     206 : F8 81               	ldi 	081h 																
(1)   16/     208 :                     __DOLeftMask:																	; 0 for left $81 for right	
(1)   17/     208 : FB 80               	xri 	080h 																; now $80 for left $01 for right
(1)   18/     20A : BE                  	phi 	re 																	; save in re.H
(1)   19/     20B : F8 0E               	ldi 	Buffer/256  														; finish setting up rf
(1)   20/     20D : BF                  	phi 	rf 
(1)   21/     20E : EF                  	sex 	rf
(1)   22/     20F :                     __DOMask:
(1)   23/     20F : 9E                  	ghi 	re 																	; get mask
(1)   24/     210 : F2                  	and 																		; and into screen.
(1)   25/     211 : 5F                  	str 	rf
(1)   26/     212 : 5F                  	str 	rf
(1)   27/     213 : 8F                  	glo 	rf 																	; next line
(1)   28/     214 : FC 08               	adi 	8
(1)   29/     216 : AF                  	plo 	rf
(1)   30/     217 : FE                  	shl
(1)   31/     218 : 3B 0F               	bnf 	__DOMask															; until done half the screen
(1)   32/     21A :                     
(1)   33/     21A : E2                  	sex 	r2 																	; X points to stack.
(1)   34/     21B : 8E                  	glo 	re 																	; get door position
(1)   35/     21C : FA 04               	ani 	4 																	; 0 if left 4 if right
(1)   36/     21E : 32 22               	bz 		__DONotRight
(1)   37/     220 : F8 07               	ldi 	7
(1)   38/     222 :                     __DONotRight:																	; 0 if left 7 if right
(1)   39/     222 : 52                  	str 	r2 																	; save at TOS.
(1)   40/     223 : 8E                  	glo 	re 																	; XOR with door position.
(1)   41/     224 : F3                  	xor 																		; so now D is distance in from edge.
(1)   42/     225 : FB 03               	xri 	3 																	; now distance from the middle.
(1)   43/     227 : FE                  	shl 																		; up four positions per depth.
(1)   44/     228 : FE                  	shl
(1)   45/     229 : 32 2D               	bz 		__DONoAdjust 														; -1 position
(1)   46/     22B : FF 01               	smi 	1
(1)   47/     22D :                     __DONoAdjust:
(1)   48/     22D : FE                  	shl 																		; multiply by 8 so index into Row
(1)   49/     22E : FE                  	shl	
(1)   50/     22F : FE                  	shl
(1)   51/     230 : 52                  	str 	r2 																	; save at R(X)
(1)   52/     231 :                     
(1)   53/     231 : 8E                  	glo 	re 																	; get door position
(1)   54/     232 : FC 78               	adi 	15*8 																; put half way down
(1)   55/     234 : F7                  	sm 																			; subtract offset
(1)   56/     235 :                     
(1)   57/     235 : AF                  	plo 	rf
(1)   58/     236 : F8 FF               	ldi	 	0FFh 																; put a solid bar there.
(1)   59/     238 : 5F                  	str 	rf
(1)   60/     239 : (MACRO)             	return
 AS V1.42 Beta [Bld 102] - source file game.asm(door.asm) - page 10 - 7/3/2016 13:36:27


(1)   60/     239 : E2                          sex     r2
(1)   60/     23A : 12                          inc     r2
(1)   60/     23B : 70                          ret
(1)   61/     23C : 30 00               	br 		DoorOpen
      88/     23E :                     	include player.asm 															; player reset/depth view ($B0)
(1)    1/     23E :                     ; ************************************************************************************************************
(1)    2/     23E :                     ; ************************************************************************************************************
(1)    3/     23E :                     ;
(1)    4/     23E :                     ;												Reset the Player
(1)    5/     23E :                     ;
(1)    6/     23E :                     ;	use RF.
(1)    7/     23E :                     ; ************************************************************************************************************
(1)    8/     23E :                     ; ************************************************************************************************************
(1)    9/     23E :                     
(1)   10/     23E :                     ResetPlayer:
(1)   11/     23E : (MACRO)             	lri 	rf,Player 															; initialise pointer, use RF as index
(1)   11/     23E : F8 0C                       ldi     (PLAYER)/256
(1)   11/     240 : BF                          phi     RF
(1)   11/     241 : F8 F3                       ldi     (PLAYER)&255
(1)   11/     243 : AF                          plo     RF
(1)   12/     244 : EF                  	sex 	rf
(1)   13/     245 : F8 77               	ldi 	7*16+7																; player at (7,7)
(1)   14/     247 : 73                  	stxd
(1)   15/     248 : F8 02               	ldi 	2 																	; direction 2
(1)   16/     24A : 73                  	stxd
(1)   17/     24B : F8 00               	ldi 	0 	
(1)   18/     24D : 73                  	stxd 																		; kills 0 (2 digits)
(1)   19/     24E : 73                  	stxd 
(1)   20/     24F : F8 FF               	ldi 	0FFh 																; point to top of timers
(1)   21/     251 : AF                  	plo 	rf
(1)   22/     252 : F8 00               	ldi 	0h 																	; clear the four timers
(1)   23/     254 : 73                  	stxd
(1)   24/     255 : 73                  	stxd
(1)   25/     256 : 73                  	stxd
(1)   26/     257 : 73                  	stxd
(1)   27/     258 : (MACRO)             	return
(1)   27/     258 : E2                          sex     r2
(1)   27/     259 : 12                          inc     r2
(1)   27/     25A : 70                          ret
(1)   28/     25B :                     
(1)   29/     25B :                     ; ************************************************************************************************************
(1)   30/     25B :                     ; ************************************************************************************************************
(1)   31/     25B :                     ;
(1)   32/     25B :                     ;						Get Player Position as a result of a move in current direction +/- n
(1)   33/     25B :                     ;										D is position RF points to the map
(1)   34/     25B :                     ;
(1)   35/     25B :                     ;	use RE,RF
(1)   36/     25B :                     ; ************************************************************************************************************
(1)   37/     25B :                     ; ************************************************************************************************************
(1)   38/     25B :                     
(1)   39/     25B :                     GetPlayerNextCurrent:
(1)   40/     25B : F8 00               	ldi 	0 																	; set offset to 0
(1)   41/     25D :                     GetPlayerNextOffset:
(1)   42/     25D : E2                  	sex 	r2
(1)   43/     25E : 52                  	str 	r2
(1)   44/     25F : (MACRO)             	lri 	rf,Direction 														; load player direction.
(1)   44/     25F : F8 0C                       ldi     (DIRECTION)/256
(1)   44/     261 : BF                          phi     RF
(1)   44/     262 : F8 F2                       ldi     (DIRECTION)&255
(1)   44/     264 : AF                          plo     RF
 AS V1.42 Beta [Bld 102] - source file game.asm(player.asm) - page 11 - 7/3/2016 13:36:27


(1)   45/     265 : 0F                  	ldn 	rf
(1)   46/     266 : F4                  	add 	 																	; get into D + offset
(1)   47/     267 : FA 03               	ani 	3 																	; force into a position.
(1)   48/     269 : FC F7               	adi 	PlayerDirectionTable & 255 											; get an address in the table
(1)   49/     26B : AE                  	plo 	re 																	; point RE to that value.
(1)   50/     26C : F8 02               	ldi 	PlayerDirectionTable / 256
(1)   51/     26E : BE                  	phi 	re
(1)   52/     26F : (MACRO)             	lri 	rf,Player 															; point RF to the position.
(1)   52/     26F : F8 0C                       ldi     (PLAYER)/256
(1)   52/     271 : BF                          phi     RF
(1)   52/     272 : F8 F3                       ldi     (PLAYER)&255
(1)   52/     274 : AF                          plo     RF
(1)   53/     275 : EE                  	sex 	re 																	; R(X) points to the direction table
(1)   54/     276 : 0F                  	ldn 	rf 																	; read position
(1)   55/     277 : F4                  	add 																		; add direction and exit.
(1)   56/     278 : AF                  	plo 	rf 																	; put in RF
(1)   57/     279 : F8 0D               	ldi 	Map/256 	
(1)   58/     27B : BF                  	phi 	rf 																	; point RF to the map entry
(1)   59/     27C : 8F                  	glo 	rf 																	; restore D
(1)   60/     27D : (MACRO)             	return
(1)   60/     27D : E2                          sex     r2
(1)   60/     27E : 12                          inc     r2
(1)   60/     27F : 70                          ret
(1)   61/     280 : 30 5D               	br 		GetPlayerNextOffset 												; re-entrant into next offset.
(1)   62/     282 :                     
(1)   63/     282 :                     ; ************************************************************************************************************
(1)   64/     282 :                     ; ************************************************************************************************************
(1)   65/     282 :                     ;
(1)   66/     282 :                     ;		Draw player view at depth D (0 = outermost, 3 = innermost). Returns DF = 0 if can move forward.
(1)   67/     282 :                     ;		D returned unchanged. Store new position at (RC) and increment RC.
(1)   68/     282 :                     ;		  
(1)   69/     282 :                     ;	Uses RA,RB,RD GetPlayerNextOffset (RE/RF) and DoorOpen(RE/RF). 
(1)   70/     282 :                     ; ************************************************************************************************************
(1)   71/     282 :                     ; ************************************************************************************************************
(1)   72/     282 :                     
(1)   73/     282 :                     DrawPlayerViewAtDepth:
(1)   74/     282 : BA                  	phi 	ra 																	; save the depth in ra.1
(1)   75/     283 :                     
(1)   76/     283 : (MACRO)             	lri 	rd,GetPlayerNextOffset												; call to identify left/right
(1)   76/     283 : F8 02                       ldi     (GETPLAYERNEXTOFFSET)/256
(1)   76/     285 : BD                          phi     RD
(1)   76/     286 : F8 5D                       ldi     (GETPLAYERNEXTOFFSET)&255
(1)   76/     288 : AD                          plo     RD
(1)   77/     289 : F8 FF               	ldi 	-1 																	; can we look left ?
(1)   78/     28B : (MACRO)             	recall 	rd    
(1)   78/     28B : 79                          mark
(1)   78/     28C : DD                          sep     RD
(1)   78/     28D : 22                          dec     r2
(1)   79/     28E : 0F                  	ldn 	rf 																	; get what's there into rb.0
(1)   80/     28F : AB                  	plo 	rb
(1)   81/     290 : F8 01               	ldi 	1 																	; can we look right ?
(1)   82/     292 : (MACRO)             	recall 	rd
(1)   82/     292 : 79                          mark
(1)   82/     293 : DD                          sep     RD
(1)   82/     294 : 22                          dec     r2
(1)   83/     295 : 0F                  	ldn 	rf 																	; get what's there into rb.1
(1)   84/     296 : BB                  	phi 	rb
(1)   85/     297 : F8 00               	ldi 	0 																	; look ahead
(1)   86/     299 : (MACRO)             	recall 	rd
(1)   86/     299 : 79                          mark
 AS V1.42 Beta [Bld 102] - source file game.asm(player.asm) - page 12 - 7/3/2016 13:36:27


(1)   86/     29A : DD                          sep     RD
(1)   86/     29B : 22                          dec     r2
(1)   87/     29C : 5C                  	str 	rc 																	; save position at (RC)
(1)   88/     29D : 0F                  	ldn 	rf 																	; get what's there into ra.0
(1)   89/     29E : AA                  	plo 	ra 	
(1)   90/     29F :                     
(1)   91/     29F : (MACRO)             	lri 	rf,Player 															; update the player position from ra.1
(1)   91/     29F : F8 0C                       ldi     (PLAYER)/256
(1)   91/     2A1 : BF                          phi     RF
(1)   91/     2A2 : F8 F3                       ldi     (PLAYER)&255
(1)   91/     2A4 : AF                          plo     RF
(1)   92/     2A5 : 0C                  	ldn 	rc 																	; read read position and update it
(1)   93/     2A6 : 5F                  	str 	rf
(1)   94/     2A7 : 1C                  	inc 	rc 																	; increment position vector pointer.
(1)   95/     2A8 :                     
(1)   96/     2A8 : (MACRO)             	lri 	rd,DoorOpen 														; prepare to show open door.
(1)   96/     2A8 : F8 02                       ldi     (DOOROPEN)/256
(1)   96/     2AA : BD                          phi     RD
(1)   96/     2AB : F8 00                       ldi     (DOOROPEN)&255
(1)   96/     2AD : AD                          plo     RD
(1)   97/     2AE : 8B                  	glo 	rb 																	; wall on left side ?
(1)   98/     2AF : FE                  	shl
(1)   99/     2B0 : 33 B6               	bdf 	__DPVNoLeftWall
(1)  100/     2B2 : 9A                  	ghi 	ra 																	; open depth up
(1)  101/     2B3 : (MACRO)             	recall 	rd 
(1)  101/     2B3 : 79                          mark
(1)  101/     2B4 : DD                          sep     RD
(1)  101/     2B5 : 22                          dec     r2
(1)  102/     2B6 :                     __DPVNoLeftWall:
(1)  103/     2B6 : 9B                  	ghi 	rb 																	; wall on right side ?
(1)  104/     2B7 : FE                  	shl
(1)  105/     2B8 : 33 C0               	bdf 	__DPVNoRightWall
(1)  106/     2BA : 9A                  	ghi 	ra 																	; open 7-depth up.
(1)  107/     2BB : FB 07               	xri 	7
(1)  108/     2BD : (MACRO)             	recall 	rd
(1)  108/     2BD : 79                          mark
(1)  108/     2BE : DD                          sep     RD
(1)  108/     2BF : 22                          dec     r2
(1)  109/     2C0 :                     __DPVNoRightWall:
(1)  110/     2C0 : 8A                  	glo 	ra 																	; get what's in front.
(1)  111/     2C1 : FE                  	shl 
(1)  112/     2C2 : 3B F1               	bnf 	__DPVExit 															; if clear exit with DF = 0
(1)  113/     2C4 :                     
(1)  114/     2C4 : 9A                  	ghi 	ra 																	; calculate start position
(1)  115/     2C5 : FC 01               	adi 	1 																	; move in one
(1)  116/     2C7 : E2                  	sex 	r2 																	; depth * 8 + depth
(1)  117/     2C8 : 52                  	str 	r2
(1)  118/     2C9 : FE                  	shl 																		; *8 * 4
(1)  119/     2CA : FE                  	shl
(1)  120/     2CB : FE                  	shl
(1)  121/     2CC : FE                  	shl
(1)  122/     2CD : FE                  	shl
(1)  123/     2CE : F4                  	add 	 																	; *9
(1)  124/     2CF : AF                  	plo 	rf 																	; set RF to point to first block. 
(1)  125/     2D0 : F8 0E               	ldi 	Buffer/256
(1)  126/     2D2 : BF                  	phi 	rf
(1)  127/     2D3 : F8 FF               	ldi 	0FFh 																; set writing value to $AA
(1)  128/     2D5 : AE                  	plo 	re
(1)  129/     2D6 :                     __DPVDrawWall:
(1)  130/     2D6 : 9A                  	ghi 	ra 																	; 0123 for depths
 AS V1.42 Beta [Bld 102] - source file game.asm(player.asm) - page 13 - 7/3/2016 13:36:27


(1)  131/     2D7 : FB 03               	xri 	3 																	; 3210 for depths
(1)  132/     2D9 : FE                  	shl 																		; 6420 for depths
(1)  133/     2DA : 32 EE               	bz 		__DPVExitWall 														; if nothing to draw skip.
(1)  134/     2DC : AB                  	plo 	rb
(1)  135/     2DD : 8F                  	glo 	rf 																	; save the start position of row.
(1)  136/     2DE : BE                  	phi 	re	
(1)  137/     2DF :                     __DPVDrawLine:
(1)  138/     2DF : 8E                  	glo 	re 																	; copy one wall piece over.
(1)  139/     2E0 : 5F                  	str 	rf
(1)  140/     2E1 : 1F                  	inc 	rf	
(1)  141/     2E2 : 2B                  	dec 	rb 																	; do required number of times
(1)  142/     2E3 : 8B                  	glo 	rb
(1)  143/     2E4 : 3A DF               	bnz 	__DPVDrawLine
(1)  144/     2E6 : AE                  	plo 	re 																	; draw spaces from here on.
(1)  145/     2E7 : 9E                  	ghi 	re 																	; get start of line RE.1
(1)  146/     2E8 : FC 08               	adi 	8
(1)  147/     2EA : AF                  	plo 	rf 																	; point RF.0 one line down.
(1)  148/     2EB : FE                  	shl
(1)  149/     2EC : 3B D6               	bnf 	__DPVDrawWall 														; go back if not reached half way.
(1)  150/     2EE :                     __DPVExitWall:
(1)  151/     2EE : F8 FF               	ldi 	0FFh 																; set DF.
(1)  152/     2F0 : FE                  	shl
(1)  153/     2F1 :                     __DPVExit:
(1)  154/     2F1 : 9A                  	ghi 	ra 																	; restore D.
(1)  155/     2F2 : (MACRO)             	return
(1)  155/     2F2 : E2                          sex     r2
(1)  155/     2F3 : 12                          inc     r2
(1)  155/     2F4 : 70                          ret
(1)  156/     2F5 : 30 82               	br 		DrawPlayerViewAtDepth
(1)  157/     2F7 :                     
(1)  158/     2F7 :                     ; ************************************************************************************************************
(1)  159/     2F7 :                     ;
(1)  160/     2F7 :                     ;										Direction to Offset table
(1)  161/     2F7 :                     ;
(1)  162/     2F7 :                     ; ************************************************************************************************************
(1)  163/     2F7 :                     
(1)  164/     2F7 :                     PlayerDirectionTable:
(1)  165/     2F7 : 01 10 FF F0         	db 		1,16,-1,-16 														; direction -> offset table.
(1)  166/     2FB :                     
      89/     2FB :                     ;
      90/     2FB :                     ;	Block 2
      91/     2FB :                     ;
      92/     300 :                     	org	 	code+200h
      93/     300 :                     	include repaint.asm 														; repaint ($8B)
(1)    1/     300 :                     ; ************************************************************************************************************
(1)    2/     300 :                     ; ************************************************************************************************************
(1)    3/     300 :                     ;
(1)    4/     300 :                     ;								Repaint whole display. No registers guaranteed
(1)    5/     300 :                     ;	
(1)    6/     300 :                     ; ************************************************************************************************************
(1)    7/     300 :                     ; ************************************************************************************************************
(1)    8/     300 :                     
(1)    9/     300 :                     Repaint:
(1)   10/     300 : (MACRO)             	call 	r5,RepaintDisplayOutline 											; clear screen and draw walls
(1)   10/     300 :  (MACRO-2)                  lri     R5,REPAINTDISPLAYOUTLINE
(1)   10/     300 : F8 01                       ldi     (REPAINTDISPLAYOUTLINE)/256
(1)   10/     302 : B5                          phi     R5
(1)   10/     303 : F8 7A                       ldi     (REPAINTDISPLAYOUTLINE)&255
(1)   10/     305 : A5                          plo     R5
(1)   10/     306 :  (MACRO-2)                  recall  R5
 AS V1.42 Beta [Bld 102] - source file game.asm(repaint.asm) - page 14 - 7/3/2016 13:36:27


(1)   10/     306 : 79                          mark
(1)   10/     307 : D5                          sep     R5
(1)   10/     308 : 22                          dec     r2
(1)   11/     309 :                     
(1)   12/     309 : (MACRO)             	lri 	rc,ppVector-1 														; point to player (vector -1)
(1)   12/     309 : F8 0C                       ldi     (PPVECTOR-1)/256
(1)   12/     30B : BC                          phi     RC
(1)   12/     30C : F8 F3                       ldi     (PPVECTOR-1)&255
(1)   12/     30E : AC                          plo     RC
(1)   13/     30F : 0C                  	ldn 	rc 																	; read player position
(1)   14/     310 : 1C                  	inc 	rc
(1)   15/     311 : 5C                  	str 	rc 																	; save in vector[0]
(1)   16/     312 : 1C                  	inc 	rc 																	; set up vector to point to 1st element
(1)   17/     313 :                     
(1)   18/     313 : (MACRO)             	lri 	r5,DrawPlayerViewAtDepth 											; draw maze at given depth
(1)   18/     313 : F8 02                       ldi     (DRAWPLAYERVIEWATDEPTH)/256
(1)   18/     315 : B5                          phi     R5
(1)   18/     316 : F8 82                       ldi     (DRAWPLAYERVIEWATDEPTH)&255
(1)   18/     318 : A5                          plo     R5
(1)   19/     319 : F8 00               	ldi 	0 																	; draw at each level
(1)   20/     31B : (MACRO)             	recall 	r5
(1)   20/     31B : 79                          mark
(1)   20/     31C : D5                          sep     R5
(1)   20/     31D : 22                          dec     r2
(1)   21/     31E : 33 33               	bdf 	__RepaintExit 														; abandon draw on solid wall
(1)   22/     320 : F8 01               	ldi 	1
(1)   23/     322 : (MACRO)             	recall 	r5
(1)   23/     322 : 79                          mark
(1)   23/     323 : D5                          sep     R5
(1)   23/     324 : 22                          dec     r2
(1)   24/     325 : 33 33               	bdf 	__RepaintExit
(1)   25/     327 : F8 02               	ldi 	2
(1)   26/     329 : (MACRO)             	recall 	r5
(1)   26/     329 : 79                          mark
(1)   26/     32A : D5                          sep     R5
(1)   26/     32B : 22                          dec     r2
(1)   27/     32C : 33 33               	bdf 	__RepaintExit
(1)   28/     32E : F8 03               	ldi 	3
(1)   29/     330 : (MACRO)             	recall 	r5
(1)   29/     330 : 79                          mark
(1)   29/     331 : D5                          sep     R5
(1)   29/     332 : 22                          dec     r2
(1)   30/     333 :                     __RepaintExit:
(1)   31/     333 :                     
(1)   32/     333 : F8 F4               	ldi 	(ppVector & 255)													; fix up the vector pointer to [0]
(1)   33/     335 : AC                  	plo 	rc
(1)   34/     336 : 0C                  	ldn 	rc 																	; reread the first player position
(1)   35/     337 : 2C                  	dec 	rc 																	; we changed it so copy it from the vector
(1)   36/     338 : 5C                  	str 	rc 																	; update actual player position.
(1)   37/     339 :                     
(1)   38/     339 : (MACRO)             	call 	r5,MirrorDisplay 													; mirror top of display to bottom
(1)   38/     339 :  (MACRO-2)                  lri     R5,MIRRORDISPLAY
(1)   38/     339 : F8 01                       ldi     (MIRRORDISPLAY)/256
(1)   38/     33B : B5                          phi     R5
(1)   38/     33C : F8 C9                       ldi     (MIRRORDISPLAY)&255
(1)   38/     33E : A5                          plo     R5
(1)   38/     33F :  (MACRO-2)                  recall  R5
(1)   38/     33F : 79                          mark
(1)   38/     340 : D5                          sep     R5
(1)   38/     341 : 22                          dec     r2
 AS V1.42 Beta [Bld 102] - source file game.asm(repaint.asm) - page 15 - 7/3/2016 13:36:27


(1)   39/     342 :                     
(1)   40/     342 : (MACRO)             	lri 	rc,ppVector 														; point RC to the positional vector.
(1)   40/     342 : F8 0C                       ldi     (PPVECTOR)/256
(1)   40/     344 : BC                          phi     RC
(1)   40/     345 : F8 F4                       ldi     (PPVECTOR)&255
(1)   40/     347 : AC                          plo     RC
(1)   41/     348 :                     __RPFindPrincess:
(1)   42/     348 : 4C                  	lda 	rc 																	; get the position to check
(1)   43/     349 : AD                  	plo 	rd 																	; make RD point to the map entry.
(1)   44/     34A : F8 0D               	ldi 	map/256
(1)   45/     34C : BD                  	phi 	rd 																	
(1)   46/     34D : 0D                  	ldn 	rd 																	; read what's there.
(1)   47/     34E : FA 7F               	ani 	7Fh 																; drop bit 7
(1)   48/     350 : 3A 5D               	bnz 	__RPFoundPrincess 													; if true, then found princess
(1)   49/     352 : 0D                  	ldn 	rd 																	; reload and look at bit 7
(1)   50/     353 : FE                  	shl
(1)   51/     354 : 33 71               	bdf 	__RPStatus 															; if found a wall don't look further
(1)   52/     356 : 8C                  	glo 	rc 
(1)   53/     357 : FB F8               	xri 	(ppVector+4) & 255
(1)   54/     359 : 3A 48               	bnz 	__RPFindPrincess 													; not done 4, try next square.
(1)   55/     35B : 30 71               	br 		__RPStatus
(1)   56/     35D :                     
(1)   57/     35D :                     __RPFoundPrincess:
(1)   58/     35D : (MACRO)             	lri 	rd,DrawSpriteGraphic 												; RD to sprite drawer.
(1)   58/     35D : F8 03                       ldi     (DRAWSPRITEGRAPHIC)/256
(1)   58/     35F : BD                          phi     RD
(1)   58/     360 : F8 99                       ldi     (DRAWSPRITEGRAPHIC)&255
(1)   58/     362 : AD                          plo     RD
(1)   59/     363 : 8C                  	glo 	rc 																	; calculate offset in vector
(1)   60/     364 : FF F5               	smi 	(ppVector & 255)+1
(1)   61/     366 : 32 6A               	bz 		__RPPointBlank 														; at level zero you're dead anyway
(1)   62/     368 : FF 01               	smi  	1
(1)   63/     36A :                     __RPPointBlank:
(1)   64/     36A : FE                  	shl 																		; x 2, 2 sprites per princess
(1)   65/     36B : (MACRO)             	recall 	rd
(1)   65/     36B : 79                          mark
(1)   65/     36C : DD                          sep     RD
(1)   65/     36D : 22                          dec     r2
(1)   66/     36E : (MACRO)             	recall 	rd
(1)   66/     36E : 79                          mark
(1)   66/     36F : DD                          sep     RD
(1)   66/     370 : 22                          dec     r2
(1)   67/     371 :                     
(1)   68/     371 :                     __RPStatus:
(1)   69/     371 : (MACRO)             	call 	r5,UpdateRadar 														; update the radar.
(1)   69/     371 :  (MACRO-2)                  lri     R5,UPDATERADAR
(1)   69/     371 : F8 05                       ldi     (UPDATERADAR)/256
(1)   69/     373 : B5                          phi     R5
(1)   69/     374 : F8 00                       ldi     (UPDATERADAR)&255
(1)   69/     376 : A5                          plo     R5
(1)   69/     377 :  (MACRO-2)                  recall  R5
(1)   69/     377 : 79                          mark
(1)   69/     378 : D5                          sep     R5
(1)   69/     379 : 22                          dec     r2
(1)   70/     37A :                     
(1)   71/     37A : F8 0F               	ldi 	Screen/256 															; not double buffered ?
(1)   72/     37C : FB 0E               	xri 	Buffer/256
(1)   73/     37E : 32 96               	bz 		__RepaintNoCopy
(1)   74/     380 :                     
(1)   75/     380 : (MACRO)             	lri 	rf,Screen 															; copy buffer to screen.
 AS V1.42 Beta [Bld 102] - source file game.asm(repaint.asm) - page 16 - 7/3/2016 13:36:27


(1)   75/     380 : F8 0F                       ldi     (SCREEN)/256
(1)   75/     382 : BF                          phi     RF
(1)   75/     383 : F8 00                       ldi     (SCREEN)&255
(1)   75/     385 : AF                          plo     RF
(1)   76/     386 : (MACRO)             	lri 	re,Buffer
(1)   76/     386 : F8 0E                       ldi     (BUFFER)/256
(1)   76/     388 : BE                          phi     RE
(1)   76/     389 : F8 00                       ldi     (BUFFER)&255
(1)   76/     38B : AE                          plo     RE
(1)   77/     38C : EE                  	sex 	re
(1)   78/     38D :                     __RepaintCopy:
(1)   79/     38D : 72                  	ldxa
(1)   80/     38E : 5F                  	str 	rf
(1)   81/     38F : 1F                  	inc 	rf
(1)   82/     390 : 72                  	ldxa
(1)   83/     391 : 5F                  	str 	rf
(1)   84/     392 : 1F                  	inc 	rf
(1)   85/     393 : 8F                  	glo 	rf
(1)   86/     394 : 3A 8D               	bnz 	__RepaintCopy	
(1)   87/     396 :                     __RepaintNoCopy:
(1)   88/     396 : (MACRO)             	return
(1)   88/     396 : E2                          sex     r2
(1)   88/     397 : 12                          inc     r2
(1)   88/     398 : 70                          ret
(1)   89/     399 :                     
(1)   90/     399 :                     
(1)   91/     399 :                     
(1)   92/     399 :                     
      94/     399 :                     	include sprites.asm 														; sprite drawing ($30)
(1)    1/     399 :                     ; ************************************************************************************************************
(1)    2/     399 :                     ; ************************************************************************************************************
(1)    3/     399 :                     ;
(1)    4/     399 :                     ;												Draw sprite graphic D
(1)    5/     399 :                     ;
(1)    6/     399 :                     ;	Uses RE,RF
(1)    7/     399 :                     ; ************************************************************************************************************
(1)    8/     399 :                     ; ************************************************************************************************************
(1)    9/     399 :                     
(1)   10/     399 :                     DrawSpriteGraphic:
(1)   11/     399 : 22                  	dec		r2 																	; save at R2
(1)   12/     39A : 52                  	str 	r2
(1)   13/     39B : FE                  	shl 																		; double the sprite number
(1)   14/     39C : FC 50               	adi 	SpriteData & 255 													; add to sprite address, put in RF
(1)   15/     39E : AF                  	plo 	rf
(1)   16/     39F : F8 07               	ldi 	SpriteData / 256
(1)   17/     3A1 : 7C 00               	adci 	0
(1)   18/     3A3 : BF                  	phi 	rf
(1)   19/     3A4 : 4F                  	lda 	rf 																	; read address into RE.
(1)   20/     3A5 : BE                  	phi 	re
(1)   21/     3A6 : 4F                  	lda 	rf
(1)   22/     3A7 : AE                  	plo 	re 
(1)   23/     3A8 :                     
(1)   24/     3A8 : 4E                  	lda 	re 																	; read the start drawing address
(1)   25/     3A9 : AF                  	plo 	rf 																	; put into RF.
(1)   26/     3AA : F8 0E               	ldi 	buffer/256 															; make into screen address
(1)   27/     3AC : BF                  	phi 	rf
(1)   28/     3AD : EE                  	sex 	re 																	; RX is data
(1)   29/     3AE :                     
(1)   30/     3AE :                     __DSGLoop:
(1)   31/     3AE : 0E                  	ldn 	re 																	; read mask.
 AS V1.42 Beta [Bld 102] - source file game.asm(sprites.asm) - page 17 - 7/3/2016 13:36:27


(1)   32/     3AF : FB FF               	xri 	0FFh 																; if $FF then finished
(1)   33/     3B1 : 32 BF               	bz 		__DSGFinished
(1)   34/     3B3 : 0F                  	ldn 	rf 																	; read screen
(1)   35/     3B4 : F2                  	and 																		; and with mask
(1)   36/     3B5 : 1E                  	inc 	re
(1)   37/     3B6 : F1                  	or 																			; or with data
(1)   38/     3B7 : 5F                  	str 	rf 																	; write out.
(1)   39/     3B8 : 1E                  	inc 	re 																	; next down
(1)   40/     3B9 : 8F                  	glo 	rf 																	 
(1)   41/     3BA : FC 08               	adi 	8
(1)   42/     3BC : AF                  	plo 	rf
(1)   43/     3BD : 30 AE               	br 		__DSGLoop
(1)   44/     3BF :                     
(1)   45/     3BF :                     __DSGFinished:
(1)   46/     3BF : 42                  	lda 	r2
(1)   47/     3C0 : FC 01               	adi 	1
(1)   48/     3C2 : (MACRO)             	return
(1)   48/     3C2 : E2                          sex     r2
(1)   48/     3C3 : 12                          inc     r2
(1)   48/     3C4 : 70                          ret
(1)   49/     3C5 :                     
(1)   50/     3C5 :                     
(1)   51/     3C5 : 30 99               	br 		DrawSpriteGraphic
      95/     3C7 :                     	include interrupt.asm														; screen driver ($1E)
(1)    1/     3C7 :                     ; ************************************************************************************************************
(1)    2/     3C7 :                     ; ************************************************************************************************************
(1)    3/     3C7 :                     ;
(1)    4/     3C7 :                     ;											1861 Display Routine
(1)    5/     3C7 :                     ;
(1)    6/     3C7 :                     ; ************************************************************************************************************
(1)    7/     3C7 :                     ; ************************************************************************************************************
(1)    8/     3C7 :                     
(1)    9/     3C7 :                     Return:
(1)   10/     3C7 : 72                  	ldxa 																		; restore DF
(1)   11/     3C8 : FE                  	shl 
(1)   12/     3C9 : 72                  	ldxa 																		; restore D
(1)   13/     3CA : 70                  	ret 																		; restore X,P
(1)   14/     3CB :                     Interrupt:
(1)   15/     3CB : 22                  	dec 	r2 																	; [2/2] save return XP on stack 
(1)   16/     3CC : 78                  	sav 																		; [2/4]
(1)   17/     3CD : 22                  	dec 	r2 																	; [2/6] save D on stack
(1)   18/     3CE : 52                  	str 	r2																	; [2/8]
(1)   19/     3CF : F8 0F               	ldi 	screen/256 															; [2/10] set up R0.1
(1)   20/     3D1 : B0                  	phi 	r0 																	; [2/12]
(1)   21/     3D2 : F8 00               	ldi 	0 																	; [2/14] set up R0.0
(1)   22/     3D4 : A0                  	plo 	r0
(1)   23/     3D5 : C4                  	nop 																		; pad out cycles till rendering
(1)   24/     3D6 : C4                  	nop
(1)   25/     3D7 : C4                  	nop
(1)   26/     3D8 :                     Refresh:
(1)   27/     3D8 : 80                  	glo 	r0 																	; do four scan lines for each row
(1)   28/     3D9 : E2                  	sex 	r2
(1)   29/     3DA :                     
(1)   30/     3DA : E2                  	sex 	r2
(1)   31/     3DB : 20                  	dec 	r0
(1)   32/     3DC : A0                  	plo 	r0
(1)   33/     3DD :                     
(1)   34/     3DD : E2                  	sex 	r2
(1)   35/     3DE : 20                  	dec 	r0
(1)   36/     3DF : A0                  	plo 	r0
 AS V1.42 Beta [Bld 102] - source file game.asm(interrupt.asm) - page 18 - 7/3/2016 13:36:27


(1)   37/     3E0 :                     
(1)   38/     3E0 : E2                  	sex 	r2
(1)   39/     3E1 : 20                  	dec 	r0
(1)   40/     3E2 : A0                  	plo 	r0
(1)   41/     3E3 :                     
(1)   42/     3E3 : 3C D8               	bn1 	Refresh 															; in emulator we never loop back
(1)   43/     3E5 :                     
(1)   44/     3E5 : 22                  	dec 	r2 																	; save DF.
(1)   45/     3E6 : 76                  	shrc 	
(1)   46/     3E7 : 52                  	str 	r2
(1)   47/     3E8 :                     
(1)   48/     3E8 : (MACRO)             	lri 	r0,timers 															; point R0 to the timers.
(1)   48/     3E8 : F8 0C                       ldi     (TIMERS)/256
(1)   48/     3EA : B0                          phi     R0
(1)   48/     3EB : F8 FC                       ldi     (TIMERS)&255
(1)   48/     3ED : A0                          plo     R0
(1)   49/     3EE :                     __IRQTimerLoop:
(1)   50/     3EE : 40                  	lda 	r0 																	; read timer value and advance
(1)   51/     3EF : 32 F6               	bz 		__IRQNextTimer	 													; if zero do next ?
(1)   52/     3F1 : 20                  	dec 	r0 																	; if not, decrement the counter.
(1)   53/     3F2 : FF 01               	smi 	1
(1)   54/     3F4 : 50                  	str 	r0
(1)   55/     3F5 : 10                  	inc 	r0
(1)   56/     3F6 :                     __IRQNextTimer:
(1)   57/     3F6 : 80                  	glo 	r0 																	; do all the tiners
(1)   58/     3F7 : 3A EE               	bnz 	__IRQTimerLoop
(1)   59/     3F9 : 30 C7               	br 		Return
      96/     3FB :                     ;
      97/     3FB :                     ; 	Block 3 
      98/     3FB :                     ;
      99/     400 :                     	org 	code+300h
     100/     400 :                     	include move.asm 															; player move/fire ($A5)
(1)    1/     400 :                     ; ************************************************************************************************************
(1)    2/     400 :                     ; ************************************************************************************************************
(1)    3/     400 :                     ;
(1)    4/     400 :                     ;											Movement code
(1)    5/     400 :                     ;
(1)    6/     400 :                     ; ************************************************************************************************************
(1)    7/     400 :                     ; ************************************************************************************************************
(1)    8/     400 :                     
(1)    9/     400 : =32H                MOVE_TurnTime = 50 																; frames per turn
(1)   10/     400 : =32H                MOVE_MoveTime = 50 																; frames per move
(1)   11/     400 : =B4H                MOVE_FireTime = 180 															; frames between firing
(1)   12/     400 :                     
(1)   13/     400 :                     MovePlayer:
(1)   14/     400 : (MACRO)             	lri 	rd,moveTimer 														; point RD to move timer
(1)   14/     400 : F8 0C                       ldi     (MOVETIMER)/256
(1)   14/     402 : BD                          phi     RD
(1)   14/     403 : F8 FC                       ldi     (MOVETIMER)&255
(1)   14/     405 : AD                          plo     RD
(1)   15/     406 : (MACRO)             	lri 	rc,direction 														; point RC to direction.
(1)   15/     406 : F8 0C                       ldi     (DIRECTION)/256
(1)   15/     408 : BC                          phi     RC
(1)   15/     409 : F8 F2                       ldi     (DIRECTION)&255
(1)   15/     40B : AC                          plo     RC
(1)   16/     40C : (MACRO)             	call 	r5,ScanKeyboard 													; read keyboard.
(1)   16/     40C :  (MACRO-2)                  lri     R5,SCANKEYBOARD
(1)   16/     40C : F8 05                       ldi     (SCANKEYBOARD)/256
(1)   16/     40E : B5                          phi     R5
(1)   16/     40F : F8 64                       ldi     (SCANKEYBOARD)&255
 AS V1.42 Beta [Bld 102] - source file game.asm(move.asm) - page 19 - 7/3/2016 13:36:28


(1)   16/     411 : A5                          plo     R5
(1)   16/     412 :  (MACRO-2)                  recall  R5
(1)   16/     412 : 79                          mark
(1)   16/     413 : D5                          sep     R5
(1)   16/     414 : 22                          dec     r2
(1)   17/     415 : AB                  	plo 	rb 																	; save in RB.0
(1)   18/     416 :                     
(1)   19/     416 : 0D                  	ldn 	rd 																	; read move timer.
(1)   20/     417 : 3A 4A               	bnz 	__MPTimer1 															; if non-zero we can't move
(1)   21/     419 :                     
(1)   22/     419 : 8B                  	glo 	rb 																	; get key press.
(1)   23/     41A : FB 04               	xri 	KEY_Left 															; if left, go to TURN with zero.
(1)   24/     41C : 32 24               	bz 		__MPTurn
(1)   25/     41E : FB 02               	xri 	KEY_Left ! KEY_Right 												; if not right, go to try MOVE
(1)   26/     420 : 3A 2E               	bnz 	__MPTryMove
(1)   27/     422 : F8 02               	ldi 	2 																	; go into TURN with 2
(1)   28/     424 :                     __MPTurn:
(1)   29/     424 : FF 01               	smi 	1 																	; make offset -1 and 1
(1)   30/     426 : EC                  	sex 	rc 																	; add to direction 
(1)   31/     427 : F4                  	add 
(1)   32/     428 : 5C                  	str 	rc 																	; write direction back.
(1)   33/     429 : F8 32               	ldi 	MOVE_TurnTime 														; reset the timer
(1)   34/     42B : 5D                  	str 	rd 
(1)   35/     42C : 30 2E               	br 		__MPTryMove
(1)   36/     42E :                     
(1)   37/     42E :                     __MPTryMove:
(1)   38/     42E : 8B                  	glo 	rb 																	; get key press
(1)   39/     42F : FB 05               	xri 	Key_Forward 														; check forward.
(1)   40/     431 : 3A 4A               	bnz 	__MPTimer1
(1)   41/     433 :                     
(1)   42/     433 : F8 32               	ldi 	MOVE_MoveTime 														; reset the timer
(1)   43/     435 : 5D                  	str 	rd 
(1)   44/     436 : (MACRO)             	lri 	rc,ppvector+1 														; get the next position forward
(1)   44/     436 : F8 0C                       ldi     (PPVECTOR+1)/256
(1)   44/     438 : BC                          phi     RC
(1)   44/     439 : F8 F5                       ldi     (PPVECTOR+1)&255
(1)   44/     43B : AC                          plo     RC
(1)   45/     43C : 0C                  	ldn 	rc 																	; via RC
(1)   46/     43D : AE                  	plo 	re 																	; save in RE.0
(1)   47/     43E : F8 0D               	ldi 	map/256 															; point RE to that map entry
(1)   48/     440 : BE                  	phi 	re
(1)   49/     441 : 0E                  	ldn 	re 																	; read the map
(1)   50/     442 : FE                  	shl 																		; check bit 7 (wall bit)
(1)   51/     443 : 33 4A               	bdf 	__MPTimer1 															; if a solid wall then can't move.
(1)   52/     445 : F8 F3               	ldi 	(player & 255) 														; make rc point to the position
(1)   53/     447 : AC                  	plo 	rc
(1)   54/     448 : 8E                  	glo 	re 																	; get the new position
(1)   55/     449 : 5C                  	str 	rc 																	; save it.
(1)   56/     44A :                     
(1)   57/     44A :                     __MPTimer1: 																
(1)   58/     44A : 1D                  	inc 	rd 																	; point to 2nd timer, fire timer
(1)   59/     44B : 0D                  	ldn 	rd  																; if that is non zero can't fire.
(1)   60/     44C : 3A 87               	bnz 	__MPExit 									
(1)   61/     44E : 8B                  	glo 	rb 																	; check if fire pressed.
(1)   62/     44F : FB 10               	xri 	Key_Fire
(1)   63/     451 : 3A 87               	bnz 	__MPExit
(1)   64/     453 : F8 B4               	ldi 	MOVE_FireTime 														; reset that timer.
(1)   65/     455 : 5D                  	str 	rd 
(1)   66/     456 :                     ;
(1)   67/     456 :                     ;	Shooting effect
 AS V1.42 Beta [Bld 102] - source file game.asm(move.asm) - page 20 - 7/3/2016 13:36:28


(1)   68/     456 :                     ;
(1)   69/     456 : F8 00               	ldi 	0 																	; use program code as random data
(1)   70/     458 : AF                  	plo 	rf 																	; drawn in the screen centre to
(1)   71/     459 : BF                  	phi 	rf 																	; give a blur effect
(1)   72/     45A :                     __MPEffect1:
(1)   73/     45A : (MACRO)             	lri 	re,Screen+8*8+3 													; middle left
(1)   73/     45A : F8 0F                       ldi     (SCREEN+8*8+3)/256
(1)   73/     45C : BE                          phi     RE
(1)   73/     45D : F8 43                       ldi     (SCREEN+8*8+3)&255
(1)   73/     45F : AE                          plo     RE
(1)   74/     460 :                     __MPEffect2: 
(1)   75/     460 : 4F                  	lda 	rf 																	; copy byte from RF into two bytes
(1)   76/     461 : 5E                  	str 	re
(1)   77/     462 : 1E                  	inc 	re
(1)   78/     463 : 5E                  	str 	re
(1)   79/     464 : 8E                  	glo 	re 																	; next line down
(1)   80/     465 : FC 07               	adi 	7
(1)   81/     467 : AE                  	plo 	re
(1)   82/     468 : FB C3               	xri 	24*8+3 																; reached bottom
(1)   83/     46A : 3A 60               	bnz 	__MPEffect2
(1)   84/     46C : 9F                  	ghi 	rf 																	; if not done whole effect go back.
(1)   85/     46D : FB 04               	xri 	04h
(1)   86/     46F : 3A 5A               	bnz 	__MPEffect1
(1)   87/     471 :                     ;
(1)   88/     471 :                     ;	Look for a princess to kill
(1)   89/     471 :                     ;
(1)   90/     471 : (MACRO)             	lri 	re,ppVector 														; point RE to the player position vector
(1)   90/     471 : F8 0C                       ldi     (PPVECTOR)/256
(1)   90/     473 : BE                          phi     RE
(1)   90/     474 : F8 F4                       ldi     (PPVECTOR)&255
(1)   90/     476 : AE                          plo     RE
(1)   91/     477 : F8 0D               	ldi 	map/256 															; RF is pointer to the map
(1)   92/     479 : BF                  	phi 	rf
(1)   93/     47A :                     __MPFindPrincess:	
(1)   94/     47A : 4E                  	lda 	re 																	; get position + advance
(1)   95/     47B : AF                  	plo 	rf 																	; rf now points into map
(1)   96/     47C : 0F                  	ldn 	rf 																	; read map element
(1)   97/     47D : FE                  	shl 																		; check bit 7 (wall)
(1)   98/     47E : 33 87               	bdf 	__MPExit 															; wall present then exit.	
(1)   99/     480 : 3A 8A               	bnz 	__MPKill 															; if non zero kill princess !
(1)  100/     482 : 8E                  	glo 	re  																; see if done the whole vector
(1)  101/     483 : FB F8               	xri 	(ppVector+4) & 255
(1)  102/     485 : 3A 7A               	bnz 	__MPFindPrincess
(1)  103/     487 :                     __MPExit:
(1)  104/     487 : (MACRO)             	return
(1)  104/     487 : E2                          sex     r2
(1)  104/     488 : 12                          inc     r2
(1)  104/     489 : 70                          ret
(1)  105/     48A :                     ;
(1)  106/     48A :                     ;	Kill princess and bump score
(1)  107/     48A :                     ;
(1)  108/     48A :                     __MPKill:
(1)  109/     48A : F8 00               	ldi 	00 																	; write zero to princess position
(1)  110/     48C : 5F                  	str 	rf
(1)  111/     48D : F8 F0               	ldi 	kills01 & 255 														; point RE to kill count
(1)  112/     48F : AE                  	plo 	re
(1)  113/     490 : 0E                  	ldn 	re 		 															; bump score
(1)  114/     491 : FC 01               	adi 	1
(1)  115/     493 : 5E                  	str 	re
(1)  116/     494 : FB 0A               	xri 	10 																	; exit if not 10 yet.
 AS V1.42 Beta [Bld 102] - source file game.asm(move.asm) - page 21 - 7/3/2016 13:36:28


(1)  117/     496 : 3A 87               	bnz 	__MPExit
(1)  118/     498 : 5E                  	str 	re 																	; zero ones
(1)  119/     499 : 1E                  	inc 	re 																	; point to tens
(1)  120/     49A : 0E                  	ldn 	re 																	; bump 10s
(1)  121/     49B : FC 01               	adi 	1
(1)  122/     49D : 5E                  	str 	re
(1)  123/     49E : FB 0A               	xri 	10 																	; reached 99....
(1)  124/     4A0 : 3A 87               	bnz 	__MPexit
(1)  125/     4A2 : 5E                  	str 	re 																	; zero tens, wraps around :)
(1)  126/     4A3 : 30 87               	br 		__MPexit
(1)  127/     4A5 :                     
     101/     4A5 :                     	include death.asm 															; death check/end ($53)
(1)    1/     4A5 :                     ; ************************************************************************************************************
(1)    2/     4A5 :                     ; ************************************************************************************************************
(1)    3/     4A5 :                     ;
(1)    4/     4A5 :                     ;													Death Check
(1)    5/     4A5 :                     ;
(1)    6/     4A5 :                     ; ************************************************************************************************************
(1)    7/     4A5 :                     ; ************************************************************************************************************
(1)    8/     4A5 :                     
(1)    9/     4A5 :                     DeathCheck:
(1)   10/     4A5 : (MACRO)             	lri 	rf,player 															; get player position
(1)   10/     4A5 : F8 0C                       ldi     (PLAYER)/256
(1)   10/     4A7 : BF                          phi     RF
(1)   10/     4A8 : F8 F3                       ldi     (PLAYER)&255
(1)   10/     4AA : AF                          plo     RF
(1)   11/     4AB : 0F                  	ldn 	rf
(1)   12/     4AC : AF                  	plo 	rf 																	; read the map location
(1)   13/     4AD : F8 0D               	ldi 	map/256 
(1)   14/     4AF : BF                  	phi 	rf
(1)   15/     4B0 : 0F                  	ldn 	rf 																	; read the map square
(1)   16/     4B1 : 32 FB               	bz 		__DCExit 															; if zero, exit, not dead
(1)   17/     4B3 :                     
(1)   18/     4B3 : (MACRO)             	lri 	r6,RandomNumber 													; erase screen randomly.
(1)   18/     4B3 : F8 01                       ldi     (RANDOMNUMBER)/256
(1)   18/     4B5 : B6                          phi     R6
(1)   18/     4B6 : F8 54                       ldi     (RANDOMNUMBER)&255
(1)   18/     4B8 : A6                          plo     R6
(1)   19/     4B9 : F8 0D               	ldi 	00Dh 																; do it roughly 13 x 256 times.
(1)   20/     4BB : B7                  	phi 	r7
(1)   21/     4BC :                     Die:
(1)   22/     4BC : (MACRO)             	lri 	re,screen+128 														; set up RE, handle problem that
(1)   22/     4BC : F8 0F                       ldi     (SCREEN+128)/256
(1)   22/     4BE : BE                          phi     RE
(1)   22/     4BF : F8 80                       ldi     (SCREEN+128)&255
(1)   22/     4C1 : AE                          plo     RE
(1)   23/     4C2 : F8 00               	ldi 	0 																	; $80 is never produced by the simple
(1)   24/     4C4 : 5E                  	str 	re 																	; RNG
(1)   25/     4C5 : (MACRO)             	recall 	r6 	 																; pick random square
(1)   25/     4C5 : 79                          mark
(1)   25/     4C6 : D6                          sep     R6
(1)   25/     4C7 : 22                          dec     r2
(1)   26/     4C8 : AE                  	plo 	re
(1)   27/     4C9 : (MACRO)             	recall 	r6 																	; pick random mask
(1)   27/     4C9 : 79                          mark
(1)   27/     4CA : D6                          sep     R6
(1)   27/     4CB : 22                          dec     r2
(1)   28/     4CC : E2                  	sex 	r2
(1)   29/     4CD : 52                  	str 	r2
(1)   30/     4CE : 0E                  	ldn 	re 																	; get screen, shift, mask, write
 AS V1.42 Beta [Bld 102] - source file game.asm(death.asm) - page 22 - 7/3/2016 13:36:28


(1)   31/     4CF : 7E                  	shlc
(1)   32/     4D0 : F2                  	and
(1)   33/     4D1 : 5E                  	str 	re
(1)   34/     4D2 : 27                  	dec 	r7 																	; dec counter, loop back if not done
(1)   35/     4D3 : 97                  	ghi 	r7
(1)   36/     4D4 : 3A BC               	bnz 	Die
(1)   37/     4D6 :                     
(1)   38/     4D6 : (MACRO)             	lri 	r5,DrawCharacter 													; code to draw character
(1)   38/     4D6 : F8 05                       ldi     (DRAWCHARACTER)/256
(1)   38/     4D8 : B5                          phi     R5
(1)   38/     4D9 : F8 71                       ldi     (DRAWCHARACTER)&255
(1)   38/     4DB : A5                          plo     R5
(1)   39/     4DC : (MACRO)             	lri 	rc,screen+8*8+2 													; draw position
(1)   39/     4DC : F8 0F                       ldi     (SCREEN+8*8+2)/256
(1)   39/     4DE : BC                          phi     RC
(1)   39/     4DF : F8 42                       ldi     (SCREEN+8*8+2)&255
(1)   39/     4E1 : AC                          plo     RC
(1)   40/     4E2 : (MACRO)             	lri 	rb,kills10  														; score
(1)   40/     4E2 : F8 0C                       ldi     (KILLS10)/256
(1)   40/     4E4 : BB                          phi     RB
(1)   40/     4E5 : F8 F1                       ldi     (KILLS10)&255
(1)   40/     4E7 : AB                          plo     RB
(1)   41/     4E8 : 0B                  	ldn 	rb 														 			; get score high
(1)   42/     4E9 : (MACRO)             	recall 	r5 																	; print it
(1)   42/     4E9 : 79                          mark
(1)   42/     4EA : D5                          sep     R5
(1)   42/     4EB : 22                          dec     r2
(1)   43/     4EC : 2B                  	dec 	rb
(1)   44/     4ED : 0B                  	ldn 	rb 																	; get score low
(1)   45/     4EE : (MACRO)             	recall 	r5 																	; print it.
(1)   45/     4EE : 79                          mark
(1)   45/     4EF : D5                          sep     R5
(1)   45/     4F0 : 22                          dec     r2
(1)   46/     4F1 : F8 00               	ldi 	0
(1)   47/     4F3 : (MACRO)             	recall	r5 																	; times 100 :)
(1)   47/     4F3 : 79                          mark
(1)   47/     4F4 : D5                          sep     R5
(1)   47/     4F5 : 22                          dec     r2
(1)   48/     4F6 : (MACRO)             	recall 	r5
(1)   48/     4F6 : 79                          mark
(1)   48/     4F7 : D5                          sep     R5
(1)   48/     4F8 : 22                          dec     r2
(1)   49/     4F9 :                     __DCHalt: 																		; game over
(1)   50/     4F9 : 30 F9               	br 		__DCHalt
(1)   51/     4FB :                     __DCExit:
(1)   52/     4FB : (MACRO)             	return
(1)   52/     4FB : E2                          sex     r2
(1)   52/     4FC : 12                          inc     r2
(1)   52/     4FD : 70                          ret
(1)   53/     4FE :                     	
(1)   54/     4FE :                     
     102/     4FE :                     ;
     103/     4FE :                     ;	Block 4
     104/     4FE :                     ;
     105/     500 :                     	org 	code+400h
     106/     500 :                     	include radar.asm 															; radar code ($68)
(1)    1/     500 :                     ; ************************************************************************************************************
(1)    2/     500 :                     ; ************************************************************************************************************
(1)    3/     500 :                     ;
(1)    4/     500 :                     ;													Radar Code
 AS V1.42 Beta [Bld 102] - source file game.asm(radar.asm) - page 23 - 7/3/2016 13:36:28


(1)    5/     500 :                     ;
(1)    6/     500 :                     ; ************************************************************************************************************
(1)    7/     500 :                     ; ************************************************************************************************************
(1)    8/     500 :                     
(1)    9/     500 :                     ; ************************************************************************************************************
(1)   10/     500 :                     ; ************************************************************************************************************
(1)   11/     500 :                     ;
(1)   12/     500 :                     ;							Calculate minimum distance of nearest princess
(1)   13/     500 :                     ;
(1)   14/     500 :                     ; ************************************************************************************************************
(1)   15/     500 :                     ; ************************************************************************************************************
(1)   16/     500 :                     
(1)   17/     500 :                     UpdateRadar:
(1)   18/     500 : 22                  	dec 	r2 																	; make a spot on the stack
(1)   19/     501 : E2                  	sex 	r2
(1)   20/     502 :                     
(1)   21/     502 : (MACRO)             	lri 	rf,player 															; read player position into RF.1
(1)   21/     502 : F8 0C                       ldi     (PLAYER)/256
(1)   21/     504 : BF                          phi     RF
(1)   21/     505 : F8 F3                       ldi     (PLAYER)&255
(1)   21/     507 : AF                          plo     RF
(1)   22/     508 : 0F                  	ldn 	rf
(1)   23/     509 : BF                  	phi 	rf
(1)   24/     50A : F8 0C               	ldi 	12 																	; best distance in RF.0
(1)   25/     50C : AF                  	plo 	rf
(1)   26/     50D : (MACRO)             	lri 	re,map 																; RE points to map.
(1)   26/     50D : F8 0D                       ldi     (MAP)/256
(1)   26/     50F : BE                          phi     RE
(1)   26/     510 : F8 00                       ldi     (MAP)&255
(1)   26/     512 : AE                          plo     RE
(1)   27/     513 :                     __RALoop:
(1)   28/     513 : 0E                  	ldn 	re 																	; read and advance
(1)   29/     514 : FA 7F               	ani 	7Fh 																; is there a princess here
(1)   30/     516 : 32 3F               	bz 		__RANext 															; no, go to next
(1)   31/     518 :                     
(1)   32/     518 : 8E                  	glo 	re 																	; get princess X
(1)   33/     519 : FA 0F               	ani 	0Fh
(1)   34/     51B : 52                  	str 	r2
(1)   35/     51C : 9F                  	ghi 	rf 																	; subtract player X
(1)   36/     51D : FA 0F               	ani 	0Fh
(1)   37/     51F : F5                  	sd
(1)   38/     520 : 33 24               	bdf 	__RANotMinusX  														; calculate |dx|
(1)   39/     522 : FD 00               	sdi 	0
(1)   40/     524 :                     __RANotMinusX:
(1)   41/     524 : BD                  	phi 	rd 																	; save in RD
(1)   42/     525 :                     
(1)   43/     525 : 8E                  	glo 	re 																	; get princess Y
(1)   44/     526 : F6                  	shr
(1)   45/     527 : F6                  	shr
(1)   46/     528 : F6                  	shr
(1)   47/     529 : F6                  	shr
(1)   48/     52A : 52                  	str 	r2
(1)   49/     52B : 9F                  	ghi 	rf 																	; subtract princess Y
(1)   50/     52C : F6                  	shr
(1)   51/     52D : F6                  	shr
(1)   52/     52E : F6                  	shr
(1)   53/     52F : F6                  	shr
(1)   54/     530 : F5                  	sd 
(1)   55/     531 : 33 35               	bdf 	__RANotMinusY 														; calculate |dy|
(1)   56/     533 : FD 00               	sdi 	0
 AS V1.42 Beta [Bld 102] - source file game.asm(radar.asm) - page 24 - 7/3/2016 13:36:28


(1)   57/     535 :                     __RANotMinusY:
(1)   58/     535 : 52                  	str 	r2 																	; calculate |dx|+|dy|
(1)   59/     536 : 9D                  	ghi 	rd
(1)   60/     537 : F4                  	add 	
(1)   61/     538 : 52                  	str 	r2
(1)   62/     539 : 8F                  	glo 	rf 																	; calculate best so far - sum
(1)   63/     53A : F7                  	sm 
(1)   64/     53B : 3B 3F               	bnf   	__RANext 															; not best to date
(1)   65/     53D : 02                  	ldn 	r2																	; get sum back
(1)   66/     53E : AF                  	plo 	rf 																	; its the new best score.
(1)   67/     53F :                     __RANext:
(1)   68/     53F : 1E                  	inc 	re 																	; next square
(1)   69/     540 : 8E                  	glo		re 																	; go back if not done all princesses.
(1)   70/     541 : 3A 13               	bnz 	__RALoop
(1)   71/     543 :                     
(1)   72/     543 :                     	;	now RF.0 is the distance from the nearest princess, maximum of 10.
(1)   73/     543 :                     
(1)   74/     543 : 8F                  	glo 	rf 																	; get RF (0-10)
(1)   75/     544 : FD 0C               	sdi 	12 																	; this is the number of half bars to draw.
(1)   76/     546 : AF                  	plo 	rf
(1)   77/     547 :                     
(1)   78/     547 : (MACRO)             	lri 	re,buffer+8+1
(1)   78/     547 : F8 0E                       ldi     (BUFFER+8+1)/256
(1)   78/     549 : BE                          phi     RE
(1)   78/     54A : F8 09                       ldi     (BUFFER+8+1)&255
(1)   78/     54C : AE                          plo     RE
(1)   79/     54D :                     
(1)   80/     54D :                     __RADrawMarker: 																; do in blocks of 8.
(1)   81/     54D : 8F                  	glo 	rf
(1)   82/     54E : FA FE               	ani 	0FEh
(1)   83/     550 : 32 5A               	bz 		__RAEndSolid
(1)   84/     552 : 2F                  	dec 	rf
(1)   85/     553 : 2F                  	dec 	rf
(1)   86/     554 : F8 AA               	ldi 	0AAh
(1)   87/     556 : 5E                  	str 	re
(1)   88/     557 : 1E                  	inc 	re
(1)   89/     558 : 30 4D               	br 		__RADrawMarker
(1)   90/     55A :                     
(1)   91/     55A :                     __RAEndSolid:
(1)   92/     55A : 8F                  	glo 	rf
(1)   93/     55B : 32 60               	bz 		__RAExit
(1)   94/     55D : F8 A0               	ldi 	0A0h
(1)   95/     55F : 5E                  	str 	re
(1)   96/     560 :                     
(1)   97/     560 :                     __RAExit:
(1)   98/     560 : 12                  	inc 	r2 																	; dump work byte from stack.
(1)   99/     561 : (MACRO)             	return
(1)   99/     561 : E2                          sex     r2
(1)   99/     562 : 12                          inc     r2
(1)   99/     563 : 70                          ret
(1)  100/     564 :                     
(1)  101/     564 :                     	
     107/     564 :                     	include keyboard.asm  														; keyboard driver ($14)
(1)    1/     564 :                     ; ************************************************************************************************************
(1)    2/     564 :                     ; ************************************************************************************************************
(1)    3/     564 :                     ;
(1)    4/     564 :                     ;						Keyboard Scanner - returns Key_xxxx other values are ignored
(1)    5/     564 :                     ;
(1)    6/     564 :                     ;	Uses RE,RF
(1)    7/     564 :                     ; ************************************************************************************************************
 AS V1.42 Beta [Bld 102] - source file game.asm(keyboard.asm) - page 25 - 7/3/2016 13:36:28


(1)    8/     564 :                     ; ************************************************************************************************************
(1)    9/     564 :                     
(1)   10/     564 : =5H                 Key_Forward = 05h 																; keyboard allocation 
(1)   11/     564 : =4H                 Key_Left = 04h 																	; these keys are chosen for a PC
(1)   12/     564 : =6H                 Key_Right = 06h 																; keyboard emulation not a Elf
(1)   13/     564 : =10H                Key_Fire = 10h  									
(1)   14/     564 :                     
(1)   15/     564 :                     ScanKeyboard:
(1)   16/     564 : E2                  	sex 	r2
(1)   17/     565 : 22                  	dec 	r2
(1)   18/     566 : 6C                  	inp 	4
(1)   19/     567 : 12                  	inc 	r2
(1)   20/     568 : FA 0F               	ani 	0Fh																	; return value in RF.
(1)   21/     56A : 3F 6E               	bn4 	__SKExit
(1)   22/     56C : F8 10               	ldi 	Key_Fire
(1)   23/     56E :                     __SKExit:
(1)   24/     56E : (MACRO)             	return
(1)   24/     56E : E2                          sex     r2
(1)   24/     56F : 12                          inc     r2
(1)   24/     570 : 70                          ret
(1)   25/     571 :                     
(1)   26/     571 :                     
     108/     571 :                     	include character.asm 														; character drawer ($25)
(1)    1/     571 :                     ; ************************************************************************************************************
(1)    2/     571 :                     ; ************************************************************************************************************
(1)    3/     571 :                     ;
(1)    4/     571 :                     ;										Plot character D at RC
(1)    5/     571 :                     ;
(1)    6/     571 :                     ;	uses RE,RF
(1)    7/     571 :                     ; ************************************************************************************************************
(1)    8/     571 :                     ; ************************************************************************************************************
(1)    9/     571 :                     
(1)   10/     571 :                     DrawCharacter:
(1)   11/     571 : E2                  	sex		r2 																	; save character
(1)   12/     572 : 22                  	dec 	r2
(1)   13/     573 : 52                  	str 	r2
(1)   14/     574 : FE                  	shl 																		; x 8
(1)   15/     575 : FE                  	shl
(1)   16/     576 : FE                  	shl
(1)   17/     577 : FC 00               	adi 	(FontData & 255) 													; add to font data
(1)   18/     579 : AF                  	plo 	rf
(1)   19/     57A : F8 07               	ldi 	(FontData / 256)
(1)   20/     57C : 7C 00               	adci 	0
(1)   21/     57E : BF                  	phi 	rf
(1)   22/     57F : F8 08               	ldi 	8 																	; counter in RE.0
(1)   23/     581 : AE                  	plo 	re
(1)   24/     582 :                     __DCCopy:
(1)   25/     582 : 4F                  	lda 	rf 																	; copy pixel data
(1)   26/     583 : 5C                  	str 	rc
(1)   27/     584 : 8C                  	glo	 	rc 																	; next line down.
(1)   28/     585 : FC 08               	adi 	8
(1)   29/     587 : AC                  	plo 	rc
(1)   30/     588 : 2E                  	dec 	re 																	; do 8 times
(1)   31/     589 : 8E                  	glo 	re
(1)   32/     58A : 3A 82               	bnz		__DCCopy
(1)   33/     58C : 8C                  	glo 	rc 																	; fix up RC to point to next ch.
(1)   34/     58D : FF 3F               	smi 	63
(1)   35/     58F : AC                  	plo 	rc
(1)   36/     590 : 72                  	ldxa 																		; restore
(1)   37/     591 : (MACRO)             	return
 AS V1.42 Beta [Bld 102] - source file game.asm(character.asm) - page 26 - 7/3/2016 13:36:28


(1)   37/     591 : E2                          sex     r2
(1)   37/     592 : 12                          inc     r2
(1)   37/     593 : 70                          ret
(1)   38/     594 : 30 71               	br 		DrawCharacter
(1)   39/     596 :                     
     109/     596 :                     ;
     110/     596 :                     ;	Block 5
     111/     596 :                     ;
     112/     600 :                     	org 	code+500h
     113/     600 :                     	include princess.asm 														; princess moving code.
(1)    1/     600 :                     ; ************************************************************************************************************
(1)    2/     600 :                     ; ************************************************************************************************************
(1)    3/     600 :                     ;
(1)    4/     600 :                     ;										Princess Movement
(1)    5/     600 :                     ;
(1)    6/     600 :                     ; ************************************************************************************************************
(1)    7/     600 :                     ; ************************************************************************************************************
(1)    8/     600 :                     
(1)    9/     600 :                     ;	Maze
(1)   10/     600 :                     ;
(1)   11/     600 :                     ;	Bit 7 		set for solid wall
(1)   12/     600 :                     ;	Bit 6 		Unused
(1)   13/     600 :                     ;	Bit 5 		Moves left (Bit 2)
(1)   14/     600 :                     ;	Bit 4 		Moves left (Bit 1)
(1)   15/     600 :                     ;	Bit 3 		Moves left (Bit 0)
(1)   16/     600 :                     ;	Bit 2 		Current Direction (High)
(1)   17/     600 :                     ;	Bit 1 		Current Direction (Low)
(1)   18/     600 :                     ;	Bit 0 		Set for princess.
(1)   19/     600 :                     ;
(1)   20/     600 :                     ; ************************************************************************************************************
(1)   21/     600 :                     ;
(1)   22/     600 :                     ;						Check if move time and if so move all princesses
(1)   23/     600 :                     ;
(1)   24/     600 :                     ; ************************************************************************************************************
(1)   25/     600 :                     
(1)   26/     600 :                     MovePrincesses:
(1)   27/     600 : (MACRO)             	lri 		rf,speed 														; read the princess speed into RE.0
(1)   27/     600 : F8 0C                       ldi     (SPEED)/256
(1)   27/     602 : BF                          phi     RF
(1)   27/     603 : F8 FB                       ldi     (SPEED)&255
(1)   27/     605 : AF                          plo     RF
(1)   28/     606 : 0F                  	ldn 		rf
(1)   29/     607 : AE                  	plo 		re
(1)   30/     608 : F8 F3               	ldi 		(player & 255)													; read player position into RE.1
(1)   31/     60A : AF                  	plo 		rf
(1)   32/     60B : 0F                  	ldn 		rf
(1)   33/     60C : BE                  	phi 		re
(1)   34/     60D : F8 FE               	ldi 		(prinTimer & 255)												; point RF to the princess timer
(1)   35/     60F : AF                  	plo 		rf
(1)   36/     610 : 0F                  	ldn 		rf
(1)   37/     611 : 3A 48               	bnz			__MVExit 														; if non-zero don't move princesses
(1)   38/     613 : 8E                  	glo 		re 																; reset the princess timer
(1)   39/     614 : 5F                  	str 		rf
(1)   40/     615 :                     
(1)   41/     615 : F8 0D               	ldi 		map/256 														; RC points to map, RD to buffer
(1)   42/     617 : BC                  	phi 		rc
(1)   43/     618 : F8 0E               	ldi 		buffer/256
(1)   44/     61A : BD                  	phi 		rd
(1)   45/     61B : F8 00               	ldi 		0
(1)   46/     61D : AC                  	plo 		rc
 AS V1.42 Beta [Bld 102] - source file game.asm(princess.asm) - page 27 - 7/3/2016 13:36:28


(1)   47/     61E : AD                  	plo 		rd
(1)   48/     61F :                     __MVCopyBuffer:																	; copy map to buffer.
(1)   49/     61F : 0C                  	ldn 		rc
(1)   50/     620 : 5D                  	str 		rd
(1)   51/     621 : 1C                  	inc 		rc
(1)   52/     622 : 1D                  	inc 		rd
(1)   53/     623 : 8C                  	glo 		rc
(1)   54/     624 : 3A 1F               	bnz 		__MVCopyBuffer
(1)   55/     626 :                     
(1)   56/     626 :                     __MVSearchPrincesses: 															; now work backwards looking for princesses
(1)   57/     626 : 2C                  	dec 		rc
(1)   58/     627 : 2D                  	dec 		rd
(1)   59/     628 : 0D                  	ldn 		rd  															; look at the map copy in the buffer.
(1)   60/     629 : FE                  	shl 																		; lose bit 7
(1)   61/     62A : 32 45               	bz   		__MVNoPrincess 													; if not found , skip to next
(1)   62/     62C :                     
(1)   63/     62C : 0D                  	ldn 		rd 																; get the princess data
(1)   64/     62D : FA 38               	ani 		00111000b 														; isolate the move count bits
(1)   65/     62F : 32 3C               	bz 			__MVNewDirection 												; if zero, we want a new direction
(1)   66/     631 : (MACRO)             	call 		r5,MoveOnePrincess												; if not, move princess
(1)   66/     631 :  (MACRO-2)                  lri     R5,MOVEONEPRINCESS
(1)   66/     631 : F8 06                       ldi     (MOVEONEPRINCESS)/256
(1)   66/     633 : B5                          phi     R5
(1)   66/     634 : F8 4B                       ldi     (MOVEONEPRINCESS)&255
(1)   66/     636 : A5                          plo     R5
(1)   66/     637 :  (MACRO-2)                  recall  R5
(1)   66/     637 : 79                          mark
(1)   66/     638 : D5                          sep     R5
(1)   66/     639 : 22                          dec     r2
(1)   67/     63A : 30 45               	br 			__MVNoPrincess
(1)   68/     63C :                     __MVNewDirection:
(1)   69/     63C : (MACRO)             	call 		r5,PrincessAI 													; find a new direction	
(1)   69/     63C :  (MACRO-2)                  lri     R5,PRINCESSAI
(1)   69/     63C : F8 06                       ldi     (PRINCESSAI)/256
(1)   69/     63E : B5                          phi     R5
(1)   69/     63F : F8 4E                       ldi     (PRINCESSAI)&255
(1)   69/     641 : A5                          plo     R5
(1)   69/     642 :  (MACRO-2)                  recall  R5
(1)   69/     642 : 79                          mark
(1)   69/     643 : D5                          sep     R5
(1)   69/     644 : 22                          dec     r2
(1)   70/     645 :                     __MVNoPrincess:
(1)   71/     645 : 8C                  	glo 		rc
(1)   72/     646 : 3A 26               	bnz 		__MVSearchPrincesses
(1)   73/     648 :                     
(1)   74/     648 :                     __MVExit:
(1)   75/     648 : (MACRO)             	return
(1)   75/     648 : E2                          sex     r2
(1)   75/     649 : 12                          inc     r2
(1)   75/     64A : 70                          ret
(1)   76/     64B :                     
(1)   77/     64B :                     ; ************************************************************************************************************
(1)   78/     64B :                     ;
(1)   79/     64B :                     ;			Move princess. RC points to target map. RE.1 is player position. RC.1 is princess position
(1)   80/     64B :                     ;
(1)   81/     64B :                     ; ************************************************************************************************************
(1)   82/     64B :                     
(1)   83/     64B :                     MoveOnePrincess:
(1)   84/     64B :                     __MOExit:
(1)   85/     64B : (MACRO)             	return
 AS V1.42 Beta [Bld 102] - source file game.asm(princess.asm) - page 28 - 7/3/2016 13:36:28


(1)   85/     64B : E2                          sex     r2
(1)   85/     64C : 12                          inc     r2
(1)   85/     64D : 70                          ret
(1)   86/     64E :                     
(1)   87/     64E :                     PrincessAI:
(1)   88/     64E : 30 4E               	br 		PrincessAI
(1)   89/     650 :                     
     114/     650 :                     
     115/     700 :                     	org 	code+600h
     116/     700 :                     FontData:
     117/     700 :                     	include font.inc 															; minimal 8x8 font.
(1)    1/     700 :                     ;
(1)    2/     700 :                     ;	Simple 8x8 Font.
(1)    3/     700 :                     ;
(1)    4/     700 :                     ;	0x7F 0x63
(1)    5/     700 :                     
(1)    6/     700 : 7F 63 63 63 63 63   	db	7fh,63h,63h,63h,63h,63h,7Fh,00h				; 0
                    7F 00 
(1)    7/     708 : 03 03 03 03 03 03   	db 	03h,03h,03h,03h,03h,03h,03h,00h
                    03 00 
(1)    8/     710 : 7F 03 03 7F 60 60   	db	7fh,03h,03h,7Fh,60h,60h,7Fh,00h
                    7F 00 
(1)    9/     718 : 7F 03 03 7F 03 03   	db	7fh,03h,03h,7Fh,03h,03h,7Fh,00h
                    7F 00 
(1)   10/     720 : 63 63 63 7F 03 03   	db 	63h,63h,63h,7Fh,03h,03h,03h,00h
                    03 00 
(1)   11/     728 : 7F 60 60 7F 03 03   	db	7fh,60h,60h,7Fh,03h,03h,7Fh,00h 			; 5
                    7F 00 
(1)   12/     730 : 7F 60 60 7F 63 63   	db	7fh,60h,60h,7Fh,63h,63h,7Fh,00h
                    7F 00 
(1)   13/     738 : 7F 03 03 03 03 03   	db 	7fh,03h,03h,03h,03h,03h,03h,00h
                    03 00 
(1)   14/     740 : 7F 63 63 7F 63 63   	db	7fh,63h,63h,7Fh,63h,63h,7Fh,00h
                    7F 00 
(1)   15/     748 : 7F 63 63 7F 03 03   	db	7fh,63h,63h,7Fh,03h,03h,7Fh,00h
                    7F 00 
(1)   16/     750 :                     
     118/     750 :                     SpriteData:	
     119/     750 :                     	include graphics.inc 														; all the graphic data
(1)    1/     750 : 07 5C                   dw __graphic00
(1)    2/     752 : 07 8E                   dw __graphic01
(1)    3/     754 : 07 C0                   dw __graphic02
(1)    4/     756 : 07 E6                   dw __graphic03
(1)    5/     758 : 08 0C                   dw __graphic04
(1)    6/     75A : 08 22                   dw __graphic05
(1)    7/     75C :                     ;        ..X XXX 
(1)    8/     75C :                     ;        .. X X  
(1)    9/     75C :                     ;        ..X XXX 
(1)   10/     75C :                     ;        ..X     
(1)   11/     75C :                     ;        ..X XXXX
(1)   12/     75C :                     ;        ..X XXXX
(1)   13/     75C :                     ;        ...X XXX
(1)   14/     75C :                     ;        ...XX   
(1)   15/     75C :                     ;        ..X     
(1)   16/     75C :                     ;        .X X    
(1)   17/     75C :                     ;        X XX    
(1)   18/     75C :                     ;        X XXX   
(1)   19/     75C :                     ;        X XXXX  
(1)   20/     75C :                     ;        X XXXXX 
(1)   21/     75C :                     ;        .X  XXXX
 AS V1.42 Beta [Bld 102] - source file game.asm(graphics.inc) - page 29 - 7/3/2016 13:36:28


(1)   22/     75C :                     ;        ..X XXXX
(1)   23/     75C :                     ;        ..X XXXX
(1)   24/     75C :                     ;        ..X XXXX
(1)   25/     75C :                     ;        ..X XXXX
(1)   26/     75C :                     ;        ..X XXXX
(1)   27/     75C :                     ;        ..X XXXX
(1)   28/     75C :                     ;        ..X XXXX
(1)   29/     75C :                     ;        ...X    
(1)   30/     75C :                     ;        ....XXXX
(1)   31/     75C :                     __graphic00:
(1)   32/     75C : 23                      db 023h
(1)   33/     75D : C0                      db 0c0h
(1)   34/     75E : 11                      db 011h
(1)   35/     75F : C0                      db 0c0h
(1)   36/     760 : 2B                      db 02bh
(1)   37/     761 : C0                      db 0c0h
(1)   38/     762 : 11                      db 011h
(1)   39/     763 : C0                      db 0c0h
(1)   40/     764 : 1F                      db 01fh
(1)   41/     765 : C0                      db 0c0h
(1)   42/     766 : 10                      db 010h
(1)   43/     767 : C0                      db 0c0h
(1)   44/     768 : 10                      db 010h
(1)   45/     769 : E0                      db 0e0h
(1)   46/     76A : 08                      db 008h
(1)   47/     76B : E0                      db 0e0h
(1)   48/     76C : 07                      db 007h
(1)   49/     76D : C0                      db 0c0h
(1)   50/     76E : 1F                      db 01fh
(1)   51/     76F : 80                      db 080h
(1)   52/     770 : 2F                      db 02fh
(1)   53/     771 : 00                      db 000h
(1)   54/     772 : 4F                      db 04fh
(1)   55/     773 : 00                      db 000h
(1)   56/     774 : 47                      db 047h
(1)   57/     775 : 00                      db 000h
(1)   58/     776 : 43                      db 043h
(1)   59/     777 : 00                      db 000h
(1)   60/     778 : 41                      db 041h
(1)   61/     779 : 80                      db 080h
(1)   62/     77A : 30                      db 030h
(1)   63/     77B : C0                      db 0c0h
(1)   64/     77C : 10                      db 010h
(1)   65/     77D : C0                      db 0c0h
(1)   66/     77E : 10                      db 010h
(1)   67/     77F : C0                      db 0c0h
(1)   68/     780 : 10                      db 010h
(1)   69/     781 : C0                      db 0c0h
(1)   70/     782 : 10                      db 010h
(1)   71/     783 : C0                      db 0c0h
(1)   72/     784 : 10                      db 010h
(1)   73/     785 : C0                      db 0c0h
(1)   74/     786 : 10                      db 010h
(1)   75/     787 : C0                      db 0c0h
(1)   76/     788 : 10                      db 010h
(1)   77/     789 : E0                      db 0e0h
(1)   78/     78A : 0F                      db 00fh
(1)   79/     78B : F0                      db 0f0h
(1)   80/     78C : 00                      db 000h
(1)   81/     78D : FF                      db 0ffh
 AS V1.42 Beta [Bld 102] - source file game.asm(graphics.inc) - page 30 - 7/3/2016 13:36:28


(1)   82/     78E :                     __graphic01:
(1)   83/     78E : 24                      db 024h
(1)   84/     78F : 03                      db 003h
(1)   85/     790 : 88                      db 088h
(1)   86/     791 : 03                      db 003h
(1)   87/     792 : D4                      db 0d4h
(1)   88/     793 : 03                      db 003h
(1)   89/     794 : 88                      db 088h
(1)   90/     795 : 03                      db 003h
(1)   91/     796 : F8                      db 0f8h
(1)   92/     797 : 03                      db 003h
(1)   93/     798 : 08                      db 008h
(1)   94/     799 : 03                      db 003h
(1)   95/     79A : 08                      db 008h
(1)   96/     79B : 07                      db 007h
(1)   97/     79C : 10                      db 010h
(1)   98/     79D : 07                      db 007h
(1)   99/     79E : E0                      db 0e0h
(1)  100/     79F : 03                      db 003h
(1)  101/     7A0 : F8                      db 0f8h
(1)  102/     7A1 : 01                      db 001h
(1)  103/     7A2 : F4                      db 0f4h
(1)  104/     7A3 : 00                      db 000h
(1)  105/     7A4 : F2                      db 0f2h
(1)  106/     7A5 : 00                      db 000h
(1)  107/     7A6 : E2                      db 0e2h
(1)  108/     7A7 : 00                      db 000h
(1)  109/     7A8 : C2                      db 0c2h
(1)  110/     7A9 : 00                      db 000h
(1)  111/     7AA : 82                      db 082h
(1)  112/     7AB : 01                      db 001h
(1)  113/     7AC : 0C                      db 00ch
(1)  114/     7AD : 03                      db 003h
(1)  115/     7AE : 08                      db 008h
(1)  116/     7AF : 03                      db 003h
(1)  117/     7B0 : 08                      db 008h
(1)  118/     7B1 : 03                      db 003h
(1)  119/     7B2 : 08                      db 008h
(1)  120/     7B3 : 03                      db 003h
(1)  121/     7B4 : 08                      db 008h
(1)  122/     7B5 : 03                      db 003h
(1)  123/     7B6 : 08                      db 008h
(1)  124/     7B7 : 03                      db 003h
(1)  125/     7B8 : 08                      db 008h
(1)  126/     7B9 : 03                      db 003h
(1)  127/     7BA : 08                      db 008h
(1)  128/     7BB : 07                      db 007h
(1)  129/     7BC : F0                      db 0f0h
(1)  130/     7BD : 0F                      db 00fh
(1)  131/     7BE : 00                      db 000h
(1)  132/     7BF : FF                      db 0ffh
(1)  133/     7C0 :                     ;        ....X..X
(1)  134/     7C0 :                     ;        ...X XX 
(1)  135/     7C0 :                     ;        ....    
(1)  136/     7C0 :                     ;        .... XXX
(1)  137/     7C0 :                     ;        ....X XX
(1)  138/     7C0 :                     ;        ....XX  
(1)  139/     7C0 :                     ;        ..XX    
(1)  140/     7C0 :                     ;        ..X X   
(1)  141/     7C0 :                     ;        .. XXX  
 AS V1.42 Beta [Bld 102] - source file game.asm(graphics.inc) - page 31 - 7/3/2016 13:36:28


(1)  142/     7C0 :                     ;        .. XXXX 
(1)  143/     7C0 :                     ;        ..X  XXX
(1)  144/     7C0 :                     ;        ...X XXX
(1)  145/     7C0 :                     ;        ...X XXX
(1)  146/     7C0 :                     ;        ...X XXX
(1)  147/     7C0 :                     ;        ...X XXX
(1)  148/     7C0 :                     ;        ...X XXX
(1)  149/     7C0 :                     ;        ....X   
(1)  150/     7C0 :                     ;        .....XXX
(1)  151/     7C0 :                     __graphic02:
(1)  152/     7C0 : 33                      db 033h
(1)  153/     7C1 : F6                      db 0f6h
(1)  154/     7C2 : 00                      db 000h
(1)  155/     7C3 : E0                      db 0e0h
(1)  156/     7C4 : 09                      db 009h
(1)  157/     7C5 : F0                      db 0f0h
(1)  158/     7C6 : 0F                      db 00fh
(1)  159/     7C7 : F0                      db 0f0h
(1)  160/     7C8 : 08                      db 008h
(1)  161/     7C9 : F0                      db 0f0h
(1)  162/     7CA : 04                      db 004h
(1)  163/     7CB : F0                      db 0f0h
(1)  164/     7CC : 03                      db 003h
(1)  165/     7CD : C0                      db 0c0h
(1)  166/     7CE : 0F                      db 00fh
(1)  167/     7CF : C0                      db 0c0h
(1)  168/     7D0 : 17                      db 017h
(1)  169/     7D1 : C0                      db 0c0h
(1)  170/     7D2 : 23                      db 023h
(1)  171/     7D3 : C0                      db 0c0h
(1)  172/     7D4 : 21                      db 021h
(1)  173/     7D5 : C0                      db 0c0h
(1)  174/     7D6 : 18                      db 018h
(1)  175/     7D7 : E0                      db 0e0h
(1)  176/     7D8 : 08                      db 008h
(1)  177/     7D9 : E0                      db 0e0h
(1)  178/     7DA : 08                      db 008h
(1)  179/     7DB : E0                      db 0e0h
(1)  180/     7DC : 08                      db 008h
(1)  181/     7DD : E0                      db 0e0h
(1)  182/     7DE : 08                      db 008h
(1)  183/     7DF : E0                      db 0e0h
(1)  184/     7E0 : 08                      db 008h
(1)  185/     7E1 : F0                      db 0f0h
(1)  186/     7E2 : 07                      db 007h
(1)  187/     7E3 : F8                      db 0f8h
(1)  188/     7E4 : 00                      db 000h
(1)  189/     7E5 : FF                      db 0ffh
(1)  190/     7E6 :                     __graphic03:
(1)  191/     7E6 : 34                      db 034h
(1)  192/     7E7 : 6F                      db 06fh
(1)  193/     7E8 : 00                      db 000h
(1)  194/     7E9 : 07                      db 007h
(1)  195/     7EA : 90                      db 090h
(1)  196/     7EB : 0F                      db 00fh
(1)  197/     7EC : F0                      db 0f0h
(1)  198/     7ED : 0F                      db 00fh
(1)  199/     7EE : 10                      db 010h
(1)  200/     7EF : 0F                      db 00fh
(1)  201/     7F0 : 20                      db 020h
 AS V1.42 Beta [Bld 102] - source file game.asm(graphics.inc) - page 32 - 7/3/2016 13:36:28


(1)  202/     7F1 : 0F                      db 00fh
(1)  203/     7F2 : C0                      db 0c0h
(1)  204/     7F3 : 03                      db 003h
(1)  205/     7F4 : F0                      db 0f0h
(1)  206/     7F5 : 03                      db 003h
(1)  207/     7F6 : E8                      db 0e8h
(1)  208/     7F7 : 03                      db 003h
(1)  209/     7F8 : C4                      db 0c4h
(1)  210/     7F9 : 03                      db 003h
(1)  211/     7FA : 84                      db 084h
(1)  212/     7FB : 03                      db 003h
(1)  213/     7FC : 18                      db 018h
(1)  214/     7FD : 07                      db 007h
(1)  215/     7FE : 10                      db 010h
(1)  216/     7FF : 07                      db 007h
(1)  217/     800 : 10                      db 010h
(1)  218/     801 : 07                      db 007h
(1)  219/     802 : 10                      db 010h
(1)  220/     803 : 07                      db 007h
(1)  221/     804 : 10                      db 010h
(1)  222/     805 : 07                      db 007h
(1)  223/     806 : 10                      db 010h
(1)  224/     807 : 0F                      db 00fh
(1)  225/     808 : E0                      db 0e0h
(1)  226/     809 : 1F                      db 01fh
(1)  227/     80A : 00                      db 000h
(1)  228/     80B : FF                      db 0ffh
(1)  229/     80C :                     ;        ....X X 
(1)  230/     80C :                     ;        ....X   
(1)  231/     80C :                     ;        ....X XX
(1)  232/     80C :                     ;        .....X X
(1)  233/     80C :                     ;        .....X  
(1)  234/     80C :                     ;        ....X X 
(1)  235/     80C :                     ;        ....X XX
(1)  236/     80C :                     ;        ....X XX
(1)  237/     80C :                     ;        .....X  
(1)  238/     80C :                     ;        ......XX
(1)  239/     80C :                     __graphic04:
(1)  240/     80C : 53                      db 053h
(1)  241/     80D : F0                      db 0f0h
(1)  242/     80E : 05                      db 005h
(1)  243/     80F : F0                      db 0f0h
(1)  244/     810 : 07                      db 007h
(1)  245/     811 : F0                      db 0f0h
(1)  246/     812 : 04                      db 004h
(1)  247/     813 : F8                      db 0f8h
(1)  248/     814 : 02                      db 002h
(1)  249/     815 : F8                      db 0f8h
(1)  250/     816 : 03                      db 003h
(1)  251/     817 : F0                      db 0f0h
(1)  252/     818 : 05                      db 005h
(1)  253/     819 : F0                      db 0f0h
(1)  254/     81A : 04                      db 004h
(1)  255/     81B : F0                      db 0f0h
(1)  256/     81C : 04                      db 004h
(1)  257/     81D : F8                      db 0f8h
(1)  258/     81E : 03                      db 003h
(1)  259/     81F : FC                      db 0fch
(1)  260/     820 : 00                      db 000h
(1)  261/     821 : FF                      db 0ffh
 AS V1.42 Beta [Bld 102] - source file game.asm(graphics.inc) - page 33 - 7/3/2016 13:36:28


(1)  262/     822 :                     __graphic05:
(1)  263/     822 : 54                      db 054h
(1)  264/     823 : 0F                      db 00fh
(1)  265/     824 : A0                      db 0a0h
(1)  266/     825 : 0F                      db 00fh
(1)  267/     826 : E0                      db 0e0h
(1)  268/     827 : 0F                      db 00fh
(1)  269/     828 : 20                      db 020h
(1)  270/     829 : 1F                      db 01fh
(1)  271/     82A : 40                      db 040h
(1)  272/     82B : 1F                      db 01fh
(1)  273/     82C : C0                      db 0c0h
(1)  274/     82D : 0F                      db 00fh
(1)  275/     82E : A0                      db 0a0h
(1)  276/     82F : 0F                      db 00fh
(1)  277/     830 : 20                      db 020h
(1)  278/     831 : 0F                      db 00fh
(1)  279/     832 : 20                      db 020h
(1)  280/     833 : 1F                      db 01fh
(1)  281/     834 : C0                      db 0c0h
(1)  282/     835 : 3F                      db 03fh
(1)  283/     836 : 00                      db 000h
(1)  284/     837 : FF                      db 0ffh
(1)  285/     838 :                     ; 220
(1)  286/     838 :                     
     120/     838 :                     
     121/     838 :                     ;	TODO: 	
     122/     838 :                     ;			Princess movement (for arbitrary placed princess), check can move in all four directions.
     123/     838 :                     ;			Princess redirection code.
     124/     838 :                     ;			Princess spawning.
     125/     838 :                     ; 			Skill level selection.
 AS V1.42 Beta [Bld 102] - source file game.asm - page 34 - 7/3/2016 13:36:28


  symbol table (* = unused):
  ------------------------

*ARCHITECTURE :  i386-unknown-win32 - | *BIGENDIAN :                      0 - |
*BRANCHEXT :                      0 - |  BUFFER :                       E00 - |
*CASESENSITIVE :                  0 - |  CODE :                         100 C |
*CONSTPI :        3.141592653589793 - |  CREATEMAZE :                   100 C |
*DATE :                    7/3/2016 - |  DEATHCHECK :                   4A5 C |
 DIE :                          4BC C |  DIRECTION :                    CF2 - |
 DOOROPEN :                     200 C |  DRAWCHARACTER :                571 C |
 DRAWPLAYERVIEWATDEPTH :        282 C |  DRAWSPRITEGRAPHIC :            399 C |
*FALSE :                          0 - | *FIRETIMER :                    CFD - |
 FONTDATA :                     700 C | *FULLPMMU :                       1 - |
*GETPLAYERNEXTCURRENT :         25B C |  GETPLAYERNEXTOFFSET :          25D C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - |  INTERRUPT :                    3CB C |
 KEY_FIRE :                      10 - |  KEY_FORWARD :                    5 - |
 KEY_LEFT :                       4 - |  KEY_RIGHT :                      6 - |
 KILLS01 :                      CF0 - |  KILLS10 :                      CF1 - |
*LISTON :                         1 - |  LOOP :                          3B C |
*MACEXP :                         1 - |  MAIN :                          15 C |
 MAP :                          D00 - |  MAZE_OPEN :                      0 - |
*MAZE_PRINCESS :                  1 - |  MAZE_WALL :                     80 - |
 MIRRORDISPLAY :                1C9 C | *MOMCPU :                      1802 - |
*MOMCPUNAME :                  1802 - |  MOVEONEPRINCESS :              64B C |
 MOVEPLAYER :                   400 C |  MOVEPRINCESSES :               600 C |
 MOVETIMER :                    CFC - |  MOVE_FIRETIME :                 B4 - |
 MOVE_MOVETIME :                 32 - |  MOVE_TURNTIME :                 32 - |
*NESTMAX :                      100 - | *PACKING :                        0 - |
*PADDING :                        1 - |  PLAYER :                       CF3 - |
 PLAYERDIRECTIONTABLE :         2F7 C |  PPVECTOR :                     CF4 - |
 PRINCESSAI :                   64E C |  PRINTIMER :                    CFE - |
 R0 :                             0 - |  R1 :                             1 - |
 R2 :                             2 - |  R3 :                             3 - |
 R4 :                             4 - |  R5 :                             5 - |
 R6 :                             6 - |  R7 :                             7 - |
*R8 :                             8 - | *R9 :                             9 - |
 RA :                             A - |  RANDOMNUMBER :                 154 C |
 RB :                             B - |  RC :                             C - |
 RD :                             D - |  RE :                             E - |
 REFRESH :                      3D8 C | *RELAXED :                        0 - |
 REPAINT :                      300 C |  REPAINTDISPLAYOUTLINE :        17A C |
 RESETPLAYER :                  23E C |  RETURN :                       3C7 C |
 RF :                             F - |  SCANKEYBOARD :                 564 C |
 SCREEN :                       F00 - |  SPEED :                        CFB - |
 SPRITEDATA :                   750 C |  STACK :                        CE8 - |
*TIME :                    13:36:27 - |  TIMERS :                       CFC - |
*TRUE :                           1 - |  UPDATERADAR :                  500 C |
*VERSION :                     142F - |  _MDLOOP :                      1CF C |
 _RDCLEAR :                     182 C |  _RDDRAWBYTEBLOCKS :            19D C |
 _RDLOOP :                      18F C |  _RDNOSOLID :                   1A8 C |
 _RDRESETMASKS :                189 C |  __CMFILL :                     107 C |
 __CMGENERATE :                 11A C |  __CMNEXT :                     14B C |
 __CMNOTDOWN :                  14B C |  __CMNOTRIGHT :                 139 C |
 __DCCOPY :                     582 C |  __DCEXIT :                     4FB C |
 __DCHALT :                     4F9 C |  __DOLEFTMASK :                 208 C |
 __DOMASK :                     20F C |  __DONOADJUST :                 22D C |
 AS V1.42 Beta [Bld 102] - source file game.asm - page 35 - 7/3/2016 13:36:28


 __DONOTRIGHT :                 222 C |  __DPVDRAWLINE :                2DF C |
 __DPVDRAWWALL :                2D6 C |  __DPVEXIT :                    2F1 C |
 __DPVEXITWALL :                2EE C |  __DPVNOLEFTWALL :              2B6 C |
 __DPVNORIGHTWALL :             2C0 C |  __DSGFINISHED :                3BF C |
 __DSGLOOP :                    3AE C |  __GRAPHIC00 :                  75C C |
 __GRAPHIC01 :                  78E C |  __GRAPHIC02 :                  7C0 C |
 __GRAPHIC03 :                  7E6 C |  __GRAPHIC04 :                  80C C |
 __GRAPHIC05 :                  822 C |  __IRQNEXTTIMER :               3F6 C |
 __IRQTIMERLOOP :               3EE C | *__MOEXIT :                     64B C |
 __MPEFFECT1 :                  45A C |  __MPEFFECT2 :                  460 C |
 __MPEXIT :                     487 C |  __MPFINDPRINCESS :             47A C |
 __MPKILL :                     48A C |  __MPTIMER1 :                   44A C |
 __MPTRYMOVE :                  42E C |  __MPTURN :                     424 C |
 __MVCOPYBUFFER :               61F C |  __MVEXIT :                     648 C |
 __MVNEWDIRECTION :             63C C |  __MVNOPRINCESS :               645 C |
 __MVSEARCHPRINCESSES :         626 C |  __RADRAWMARKER :               54D C |
 __RAENDSOLID :                 55A C |  __RAEXIT :                     560 C |
 __RALOOP :                     513 C |  __RANEXT :                     53F C |
 __RANOTMINUSX :                524 C |  __RANOTMINUSY :                535 C |
 __REPAINTCOPY :                38D C |  __REPAINTEXIT :                333 C |
 __REPAINTNOCOPY :              396 C |  __RNHIGHM1 :                   15A C |
 __RNLOWM1 :                    161 C |  __RNNOTOGGLE :                 170 C |
 __RPFINDPRINCESS :             348 C |  __RPFOUNDPRINCESS :            35D C |
 __RPPOINTBLANK :               36A C |  __RPSTATUS :                   371 C |
 __SKEXIT :                     56E C |

    163 symbols
     34 unused symbols

 AS V1.42 Beta [Bld 102] - source file game.asm - page 36 - 7/3/2016 13:36:28


  defined macros:
  ---------------

CALL                                  | LRI                                  
RECALL                                | RETURN                               

      4 macros

 AS V1.42 Beta [Bld 102] - source file game.asm - page 37 - 7/3/2016 13:36:28


  codepages:
  ----------

STANDARD (0 changed characters)


0.14 seconds assembly time

   1573 lines source file
   1941 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
