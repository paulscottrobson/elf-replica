 AS V1.42 Beta [Bld 102] - source file test.asm - page 1 - 6/29/2016 22:09:53


       1/       0 :                     
       2/       0 :                     	cpu 	1802
       3/       0 :                     
       4/       0 :                     
       5/       0 : =FH                 display = 00Fh
       6/       0 : =EH                 map = 00Eh
       7/       0 : =DH                 stack = 00Dh
       8/       0 :                     
       9/       0 : =0H                 r0 = 0
      10/       0 : =1H                 r1 = 1
      11/       0 : =2H                 r2 = 2
      12/       0 : =3H                 r3 = 3
      13/       0 : =4H                 r4 = 4
      14/       0 : =5H                 r5 = 5
      15/       0 : =6H                 r6 = 6
      16/       0 : =7H                 r7 = 7
      17/       0 : =8H                 r8 = 8
      18/       0 : =9H                 r9 = 9
      19/       0 : =FH                 rf = 15
      20/       0 :                     
      21/       0 : 90                  	ghi 	r0
      22/       1 : B1                  	phi		r1
      23/       2 :                     
      24/       2 : F8 0D               	ldi 	stack
      25/       4 : B2                  	phi		r2
      26/       5 : F8 FF               	ldi 	0FFh
      27/       7 : A2                  	plo 	r2
      28/       8 :                     
      29/       8 : F8 01               	ldi 	Main / 256
      30/       A : B3                  	phi 	r3
      31/       B : F8 00               	ldi 	Main & 255
      32/       D : A3                  	plo 	r3
      33/       E :                     
      34/       E : F8 00               	ldi 	Interrupt / 256
      35/      10 : B1                  	phi 	r1
      36/      11 : F8 17               	ldi 	Interrupt & 255
      37/      13 : A1                  	plo 	r1
      38/      14 : D3                  	sep 	r3
      39/      15 :                     
      40/      15 :                     Return:
      41/      15 : 72                  	ldxa
      42/      16 : 70                  	ret
      43/      17 :                     Interrupt:
      44/      17 : 22                  	dec 	r2
      45/      18 : 78                  	sav
      46/      19 : 22                  	dec 	r2
      47/      1A : 52                  	str 	r2
      48/      1B : C4                  	nop
      49/      1C : C4                  	nop
      50/      1D : C4                  	nop
      51/      1E : F8 0F               	ldi 	display
      52/      20 : B0                  	phi 	r0
      53/      21 : F8 00               	ldi 	0
      54/      23 : A0                  	plo 	r0
      55/      24 :                     Refresh:
      56/      24 : 80                  	glo 	r0
      57/      25 : E2                  	sex 	r2
      58/      26 :                     
      59/      26 : E2                  	sex 	r2
      60/      27 : 20                  	dec 	r0
 AS V1.42 Beta [Bld 102] - source file test.asm - page 2 - 6/29/2016 22:09:53


      61/      28 : A0                  	plo 	r0
      62/      29 :                     
      63/      29 : E2                  	sex 	r2
      64/      2A : 20                  	dec 	r0
      65/      2B : A0                  	plo 	r0
      66/      2C :                     
      67/      2C : E2                  	sex 	r2
      68/      2D : 20                  	dec 	r0
      69/      2E : A0                  	plo 	r0
      70/      2F :                     
      71/      2F : 3C 24               	bn1 	Refresh
      72/      31 : 30 15               	br 		Return
      73/      33 :                     
      74/     100 :                     	org 	0100h
      75/     100 :                     
      76/     100 :                     Main:
      77/     100 : E2                  	sex 	r2
      78/     101 : 69                  	inp		1
      79/     102 :                     
      80/     102 :                     ; ************************************************************************************************************
      81/     102 :                     ; ************************************************************************************************************
      82/     102 :                     ;
      83/     102 :                     ;												Repaint entire display
      84/     102 :                     ;
      85/     102 :                     ; ************************************************************************************************************
      86/     102 :                     ; ************************************************************************************************************
      87/     102 :                     
      88/     102 :                     RepaintDisplay:
      89/     102 : F8 0F               	ldi 	display 															; r4 points to display position.
      90/     104 : B4                  	phi 	r4 																	; so does R5 as we're going to clear it
      91/     105 : B5                  	phi 	r5 																	; the top half of the screen
      92/     106 : F8 00               	ldi 	0
      93/     108 : A4                  	plo 	r4
      94/     109 : A5                  	plo 	r5
      95/     10A :                     _RDClear:
      96/     10A : 84                  	glo 	r4 																	; R4.0 is zero
      97/     10B : 55                  	str 	r5 																	; fill display RAM with it.
      98/     10C : 15                  	inc 	r5
      99/     10D : 85                  	glo 	r5
     100/     10E : 7E                  	shlc 																		; only do it half way as we copy
     101/     10F : 3B 0A               	bnf 	_RDClear 															; the bottom half.
     102/     111 :                     
     103/     111 :                     ; ************************************************************************************************************
     104/     111 :                     ;									    Come back here to reset the masks
     105/     111 :                     ; ************************************************************************************************************
     106/     111 :                     
     107/     111 :                     RepaintDisplayResetMasks:
     108/     111 : F8 C0               	ldi 	0C0h 																; r7.0 is 11000000 (left write)
     109/     113 : A7                  	plo 	r7
     110/     114 : F8 03               	ldi 	3 																	; r7.1 is 00000011 (right write)
     111/     116 : B7                  	phi 	r7
     112/     117 :                     
     113/     117 :                     ; ************************************************************************************************************
     114/     117 :                     ;				Main repaint loop. R4 points to the line position. R7.0 left mask R7.1 right mask
     115/     117 :                     ; ************************************************************************************************************
     116/     117 :                     
     117/     117 :                     RepaintDisplayLoop:
     118/     117 : 94                  	ghi		r4 																	; copy R4.1 to R5.1 and R6.1
     119/     118 : B5                  	phi 	r5 																	
     120/     119 : B6                  	phi 	r6
 AS V1.42 Beta [Bld 102] - source file test.asm - page 3 - 6/29/2016 22:09:53


     121/     11A : 84                  	glo 	r4 																	; are there no solid blocks yet ?
     122/     11B : FA 07               	ani 	7
     123/     11D : 32 30               	bz 		RepaintNoSolid
     124/     11F : 84                  	glo 	r4 																	; R5.0 will point to left bit
     125/     120 : A5                  	plo 	r5
     126/     121 : FB 07               	xri 	7																	; R5.1 will point to right bit
     127/     123 : A6                  	plo 	r6																	
     128/     124 : 25                  	dec 	r5
     129/     125 :                     
     130/     125 :                     PaintSolidBlocks:
     131/     125 : F8 FF               	ldi 	0FFh 																; write solid block on left.
     132/     127 : 55                  	str 	r5
     133/     128 : 56                  	str 	r6
     134/     129 : 25                  	dec 	r5 																	; move left left and right right
     135/     12A : 16                  	inc 	r6
     136/     12B : 86                  	glo 	r6 																	; if right hasn't wrapped around
     137/     12C : FA 07               	ani 	7
     138/     12E : 3A 25               	bnz 	PaintSolidBlocks
     139/     130 :                     RepaintNoSolid:
     140/     130 :                     
     141/     130 : 84                  	glo 	r4 																	; set R5 and R6 to point to write
     142/     131 : A5                  	plo 	r5
     143/     132 : FB 07               	xri 	7
     144/     134 : A6                  	plo 	r6
     145/     135 :                     
     146/     135 : 84                  	glo 	r4 																	; point R4 to the next line.
     147/     136 : FC 08               	adi 	8
     148/     138 : A4                  	plo 	r4
     149/     139 :                     
     150/     139 : 87                  	glo 	r7																	; write left mask
     151/     13A : 55                  	str 	r5
     152/     13B : 76                  	shrc 																		; update the left mask.
     153/     13C : 76                  	shrc	
     154/     13D : F9 C0               	ori 	0C0h
     155/     13F : A7                  	plo 	r7
     156/     140 :                     
     157/     140 : 97                  	ghi 	r7 																	; write right mask
     158/     141 : 56                  	str 	r6
     159/     142 : 7E                  	shlc 																		; update the right mask.
     160/     143 : 7E                  	shlc 
     161/     144 : F9 03               	ori 	3
     162/     146 : B7                  	phi	 	r7
     163/     147 :                     
     164/     147 : 3B 17               	bnf 	RepaintDisplayLoop
     165/     149 : 14                  	inc 	r4 																	; step out 1.
     166/     14A : 84                  	glo 	r4 																	; if not half way down loop back.
     167/     14B : 7E                  	shlc
     168/     14C : 3B 11               	bnf 	RepaintDisplayResetMasks
     169/     14E :                     
     170/     14E :                     ; ************************************************************************************************************
     171/     14E :                     ;									Now copy top half to bottom half upside down
     172/     14E :                     ; ************************************************************************************************************
     173/     14E :                     	
     174/     14E : F8 0F               	ldi 	Display 															; R4 points to screen top
     175/     150 : B4                  	phi 	r4 
     176/     151 : F8 00               	ldi 	0  															
     177/     153 : A4                  	plo 	r4 
     178/     154 :                     MirrorLoop:
     179/     154 : 84                  	glo 	r4 																	; set up bottom pointer r5
     180/     155 : FB F8               	xri 	0F8h
 AS V1.42 Beta [Bld 102] - source file test.asm - page 4 - 6/29/2016 22:09:53


     181/     157 : A5                  	plo 	r5	
     182/     158 : 94                  	ghi	 	r4
     183/     159 : B5                  	phi 	r5
     184/     15A : 44                  	lda 	r4 																	; copy data bumping R4
     185/     15B : 55                  	str 	r5
     186/     15C : 15                  	inc 	r5
     187/     15D : 84                  	glo 	r4
     188/     15E : 7E                  	shlc 	
     189/     15F : 3B 54               	bnf 	MirrorLoop
     190/     161 :                     
     191/     161 : 1F                  	inc 	15
     192/     162 : 30 02               	br 		RepaintDisplay
     193/     164 :                     wait:
     194/     164 : 30 64               	br 		wait
 AS V1.42 Beta [Bld 102] - source file test.asm - page 5 - 6/29/2016 22:09:53


  symbol table (* = unused):
  ------------------------

*ARCHITECTURE :  i386-unknown-win32 - | *BIGENDIAN :                      0 - |
*BRANCHEXT :                      0 - | *CASESENSITIVE :                  0 - |
*CONSTPI :        3.141592653589793 - | *DATE :                   6/29/2016 - |
 DISPLAY :                        F - | *FALSE :                          0 - |
*FULLPMMU :                       1 - | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
 INTERRUPT :                     17 C | *LISTON :                         1 - |
*MACEXP :                         1 - |  MAIN :                         100 C |
*MAP :                            E - |  MIRRORLOOP :                   154 C |
*MOMCPU :                      1802 - | *MOMCPUNAME :                  1802 - |
*NESTMAX :                      100 - | *PACKING :                        0 - |
*PADDING :                        1 - |  PAINTSOLIDBLOCKS :             125 C |
 R0 :                             0 - |  R1 :                             1 - |
 R2 :                             2 - |  R3 :                             3 - |
 R4 :                             4 - |  R5 :                             5 - |
 R6 :                             6 - |  R7 :                             7 - |
*R8 :                             8 - | *R9 :                             9 - |
 REFRESH :                       24 C | *RELAXED :                        0 - |
 REPAINTDISPLAY :               102 C |  REPAINTDISPLAYLOOP :           117 C |
 REPAINTDISPLAYRESETMASKS :     111 C |  REPAINTNOSOLID :               130 C |
 RETURN :                        15 C | *RF :                             F - |
 STACK :                          D - | *TIME :                    22:09:53 - |
*TRUE :                           1 - | *VERSION :                     142F - |
 WAIT :                         164 C |  _RDCLEAR :                     10A C |

     54 symbols
     32 unused symbols

 AS V1.42 Beta [Bld 102] - source file test.asm - page 6 - 6/29/2016 22:09:53


  codepages:
  ----------

STANDARD (0 changed characters)


0.01 seconds assembly time

    194 lines source file
      2 passes
      0 errors
      0 warnings
